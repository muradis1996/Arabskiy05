<!doctype html>
<html lang="ru" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê—Ä–∞–±—Å–∫–∏–π –¥–ª—è –ö–æ—Ä–∞–Ω–∞</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='bg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%2300ff88'/><stop offset='100%25' style='stop-color:%2300ccff'/></linearGradient></defs><rect width='100' height='100' fill='url(%23bg)' rx='20'/><text x='50' y='35' font-family='serif' font-size='24' fill='white' text-anchor='middle' font-weight='bold'>ÿπ</text><text x='50' y='65' font-family='sans-serif' font-size='12' fill='white' text-anchor='middle'>ŸÇÿ±ÿ¢ŸÜ</text></svg>" type="image/svg+xml">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        .arabic-text {
            font-family: 'Amiri', 'Traditional Arabic', serif;
            font-size: 2.5rem;
            direction: rtl;
            text-align: right;
        }
        
        .progress-bar {
            transition: width 0.2s ease;
            background: linear-gradient(90deg, #00ff88, #00ccff);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }
        
        .task-card {
            transition: all 0.2s ease;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 1px solid #00ff88;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.1);
        }
        
        .correct-answer {
            background: linear-gradient(135deg, #00ff88, #00cc66) !important;
            color: #000 !important;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.6);
            font-weight: bold;
        }
        
        .incorrect-answer {
            background: linear-gradient(135deg, #ff0066, #cc0044) !important;
            color: white !important;
            box-shadow: 0 0 15px rgba(255, 0, 102, 0.6);
        }
        
        .option-button {
            transition: all 0.15s ease;
            background: linear-gradient(135deg, #2a2a4a, #1e1e3f);
            border: 1px solid #444;
            color: #fff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            font-size: 1.1rem;
            padding: 1rem;
        }
        
        @media (hover: hover) {
            .option-button:hover:not(:disabled) {
                transform: translateY(-2px);
                box-shadow: 0 4px 15px rgba(0, 255, 136, 0.3);
                border-color: #00ff88;
                background: linear-gradient(135deg, #3a3a5a, #2e2e4f);
            }
        }
        
        .lesson-card {
            background: linear-gradient(135deg, #2a2a4a, #1e1e3f);
            border: 1px solid #444;
            transition: all 0.15s ease;
        }
        
        @media (hover: hover) {
            .lesson-card:hover {
                border-color: #00ff88;
                box-shadow: 0 4px 15px rgba(0, 255, 136, 0.2);
                transform: translateY(-2px);
            }
        }
        
        .lesson-card.completed {
            border-color: #00ff88;
            background: linear-gradient(135deg, #1a4a2a, #1e3f1e);
        }
        
        .lesson-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .exam-card {
            background: linear-gradient(135deg, #4a2a2a, #3f1e1e);
            border: 2px solid #ff6600;
            box-shadow: 0 0 20px rgba(255, 102, 0, 0.3);
        }
        
        .exam-card.completed {
            border-color: #00ff88;
            background: linear-gradient(135deg, #2a4a2a, #1e3f1e);
        }
        
        .word-button {
            transition: all 0.15s ease;
            cursor: pointer;
            background: linear-gradient(135deg, #2a2a4a, #1e1e3f);
            border: 1px solid #444;
            color: #fff;
            font-size: 1.1rem;
            padding: 0.75rem 1rem;
        }
        
        @media (hover: hover) {
            .word-button:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0, 204, 255, 0.4);
                border-color: #00ccff;
            }
        }
        
        .selected-word {
            background: linear-gradient(135deg, #00ccff, #0099cc) !important;
            color: #000 !important;
            box-shadow: 0 0 12px rgba(0, 204, 255, 0.6);
            font-weight: bold;
        }
        
        .neon-text {
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.8);
        }
        
        .neon-border {
            border: 1px solid #00ff88;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .dictionary-card {
            perspective: 1000px;
            height: 120px;
            cursor: pointer;
        }
        
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .dictionary-card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 16px;
        }
        
        .card-front {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 1px solid #00ff88;
        }
        
        .card-back {
            background: linear-gradient(135deg, #2a2a4a, #1e1e3f);
            border: 1px solid #00ccff;
            transform: rotateY(180deg);
        }
        
        .glow-button {
            background: linear-gradient(135deg, #00ff88, #00cc66);
            color: #000;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.4);
            transition: all 0.15s ease;
        }
        
        @media (hover: hover) {
            .glow-button:hover {
                box-shadow: 0 0 25px rgba(0, 255, 136, 0.6);
                transform: translateY(-1px);
            }
        }
        
        .exam-button {
            background: linear-gradient(135deg, #ff6600, #cc4400);
            color: white;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(255, 102, 0, 0.4);
        }
        
        @media (hover: hover) {
            .exam-button:hover {
                box-shadow: 0 0 25px rgba(255, 102, 0, 0.6);
                transform: translateY(-1px);
            }
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #00ff88, #00cc66);
            color: #000;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.4);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .github-info {
            background: linear-gradient(135deg, #2a2a4a, #1e1e3f);
            border: 1px solid #444;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .sentence-builder {
            min-height: 80px;
            border: 2px dashed #444;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            justify-content: center;
        }

        .sentence-builder.has-words {
            border-color: #00ff88;
            background: linear-gradient(135deg, #1a2e1a, #162e16);
        }

        .test-word-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin: 20px 0;
        }

        .test-word {
            background: linear-gradient(135deg, #2a2a4a, #1e1e3f);
            border: 1px solid #444;
            color: #fff;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
            font-size: 1.1rem;
        }

        .test-word:hover {
            border-color: #00ccff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 204, 255, 0.4);
        }

        .test-word.used {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .sentence-word {
            background: linear-gradient(135deg, #00ccff, #0099cc);
            color: #000;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-gradient-to-br from-gray-900 via-purple-900 to-black font-sans">
  <div class="min-h-full flex flex-col"><!-- Header -->
   <header class="bg-gradient-to-r from-gray-800 to-gray-900 shadow-lg border-b border-green-400 neon-border">
    <div class="max-w-6xl mx-auto px-4 py-4">
     <div class="flex items-center justify-between">
      <div>
       <h1 id="course-title" class="text-2xl font-bold text-white neon-text">–ê—Ä–∞–±—Å–∫–∏–π –¥–ª—è –ö–æ—Ä–∞–Ω–∞</h1>
       <p class="text-green-300">100 —É—Ä–æ–∫–æ–≤ –∫–æ—Ä–∞–Ω–∏—á–µ—Å–∫–æ–π –ª–µ–∫—Å–∏–∫–∏</p>
      </div>
      <div class="text-right">
       <div class="text-sm text-green-300 mb-1">
        –ü—Ä–æ–≥—Ä–µ—Å—Å: <span id="overall-progress">0/100</span>
       </div>
       <div class="w-48 bg-gray-700 rounded-full h-3 border border-gray-600">
        <div id="overall-progress-bar" class="progress-bar h-3 rounded-full" style="width: 0%"></div>
       </div>
      </div>
     </div>
    </div>
   </header><!-- Main Content -->
   <main class="flex-1 p-4"><!-- Home Screen -->
    <div id="home-screen" class="max-w-4xl mx-auto text-center"><!-- GitHub Info -->
     <div class="github-info text-left mb-8">
      <h3 class="text-lg font-bold text-cyan-300 mb-2">üì± GitHub Pages –≤–µ—Ä—Å–∏—è</h3>
      <p class="text-gray-300 text-sm mb-2">–î–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç localStorage –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.</p>
      <p class="text-gray-400 text-xs">–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Å–µ—â–µ–Ω–∏–∏ —Å —Ç–æ–≥–æ –∂–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.</p>
     </div>
     <div class="mb-12">
      <h1 class="text-4xl font-bold text-white neon-text mb-4" id="main-title">–ê—Ä–∞–±—Å–∫–∏–π –¥–ª—è –ö–æ—Ä–∞–Ω–∞</h1>
      <p class="text-green-300 text-lg mb-8">–ò–∑—É—á–∞–π—Ç–µ —Å–≤—è—â–µ–Ω–Ω—ã–π —è–∑—ã–∫ –ö–æ—Ä–∞–Ω–∞ –ø–æ—à–∞–≥–æ–≤–æ</p><!-- Motivational Ayah -->
      <div class="bg-gradient-to-r from-gray-800 to-gray-700 rounded-xl p-8 mb-12 cursor-pointer" onclick="changeAyah()">
       <div class="text-2xl arabic-text text-white mb-4" id="ayah-arabic">
        ŸàŸéŸÇŸèŸÑ ÿ±ŸéŸëÿ®ŸêŸë ÿ≤ŸêÿØŸíŸÜŸêŸä ÿπŸêŸÑŸíŸÖŸãÿß
       </div>
       <div class="text-green-300 mb-2" id="ayah-translation">
        "–ò –≥–æ–≤–æ—Ä–∏: –ì–æ—Å–ø–æ–¥–∏ –º–æ–π! –£–º–Ω–æ–∂—å –º–æ–∏ –∑–Ω–∞–Ω–∏—è!"
       </div>
       <div class="text-sm text-gray-400" id="ayah-reference">
        –ö–æ—Ä–∞–Ω 20:114
       </div>
       <div class="text-xs text-cyan-300 mt-3">
        –ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Å–º–µ–Ω—ã –∞—è—Ç–∞
       </div>
      </div><!-- Main Menu Buttons -->
      <div class="grid grid-cols-1 gap-4"><button class="bg-gradient-to-br from-purple-600 to-purple-800 text-white rounded-xl p-6 text-left transition-all hover:from-purple-500 hover:to-purple-700" onclick="showLessons()">
        <div class="text-3xl mb-3">
         üìö
        </div><h3 class="text-lg font-bold mb-2">–£—Ä–æ–∫–∏</h3><p class="text-sm text-purple-200">100 —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—Ä–æ–∫–æ–≤ –∫–æ—Ä–∞–Ω–∏—á–µ—Å–∫–æ–π –ª–µ–∫—Å–∏–∫–∏</p>
        <div class="mt-3 text-sm text-purple-300">
         –ü—Ä–æ–≥—Ä–µ—Å—Å: <span id="home-progress">0/100</span>
        </div></button> <button class="bg-gradient-to-br from-purple-600 to-purple-800 text-white rounded-xl p-6 text-left transition-all hover:from-purple-500 hover:to-purple-700" onclick="showDictionary()">
        <div class="text-3xl mb-3">
         üìñ
        </div><h3 class="text-lg font-bold mb-2">–°–ª–æ–≤–∞—Ä—å</h3><p class="text-sm text-purple-200">–í—Å–µ –∏–∑—É—á–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞ —Å –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏ –∏ –∫–æ—Ä–Ω—è–º–∏</p>
        <div class="mt-3 text-sm text-purple-300">
         –°–ª–æ–≤ –∏–∑—É—á–µ–Ω–æ: <span id="words-learned">0</span>
        </div></button> <button class="bg-gradient-to-br from-orange-600 to-orange-800 text-white rounded-xl p-6 text-left transition-all hover:from-orange-500 hover:to-orange-700" onclick="showTests()">
        <div class="text-3xl mb-3">
         üß©
        </div><h3 class="text-lg font-bold mb-2">–¢–µ—Å—Ç—ã</h3><p class="text-sm text-orange-200">–°–æ–±–∏—Ä–∞–π—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏–∑ –∏–∑—É—á–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤</p>
        <div class="mt-3 text-sm text-orange-300">
         –í–∏–∫—Ç–æ—Ä–∏–Ω—ã –Ω–∞ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ñ—Ä–∞–∑
        </div></button> <!-- Data Management -->
       <div class="bg-gradient-to-br from-gray-600 to-gray-800 text-white rounded-xl p-6 text-left">
        <div class="text-3xl mb-3">
         üíæ
        </div>
        <h3 class="text-lg font-bold mb-2">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</h3>
        <p class="text-sm text-gray-200 mb-4">–≠–∫—Å–ø–æ—Ä—Ç –∏ –∏–º–ø–æ—Ä—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</p>
        <div class="flex gap-2 flex-wrap"><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm transition-colors" onclick="exportProgress()"> –≠–∫—Å–ø–æ—Ä—Ç </button> <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm transition-colors" onclick="importProgress()"> –ò–º–ø–æ—Ä—Ç </button>
        </div>
       </div>
      </div>
     </div>
    </div><!-- Lesson Selection Screen -->
    <div id="lesson-selection" class="hidden max-w-6xl mx-auto">
     <div class="flex items-center justify-between mb-6"><button class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2" onclick="showHome()"> ‚Üê –ì–ª–∞–≤–Ω–∞—è </button>
      <h2 class="text-2xl font-bold text-white neon-text">–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫</h2>
      <div></div>
     </div>
     <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3" id="lessons-grid"><!-- Lessons will be generated here -->
     </div>
    </div><!-- Dictionary Screen -->
    <div id="dictionary-screen" class="hidden max-w-4xl mx-auto">
     <div class="flex items-center justify-between mb-6"><button class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2" onclick="showHome()"> ‚Üê –ì–ª–∞–≤–Ω–∞—è </button>
      <h2 class="text-2xl font-bold text-white neon-text">–°–ª–æ–≤–∞—Ä—å</h2>
      <div class="text-sm text-green-300"><span id="dict-word-count">0</span> —Å–ª–æ–≤
      </div>
     </div><!-- Search and Filter -->
     <div class="bg-gradient-to-r from-gray-800 to-gray-700 border border-green-400 rounded-lg p-4 mb-6">
      <div class="flex flex-col md:flex-row gap-4"><input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∞—Ä–∞–±—Å–∫–æ–º—É —Ç–µ–∫—Å—Ç—É –∏–ª–∏ –ø–µ—Ä–µ–≤–æ–¥—É..." class="flex-1 bg-gray-900 border border-gray-600 rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:border-green-400 focus:outline-none"> <select id="type-filter" class="bg-gray-900 border border-gray-600 rounded-lg px-4 py-2 text-white focus:border-green-400 focus:outline-none"> <option value="">–í—Å–µ —Ç–∏–ø—ã</option> <option value="noun">–°—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ</option> <option value="verb">–ì–ª–∞–≥–æ–ª—ã</option> <option value="adjective">–ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ</option> <option value="preposition">–ü—Ä–µ–¥–ª–æ–≥–∏</option> <option value="pronoun">–ú–µ—Å—Ç–æ–∏–º–µ–Ω–∏—è</option> </select>
      </div>
     </div><!-- Dictionary Content -->
     <div id="dictionary-content" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"><!-- Dictionary words will be generated here -->
     </div>
    </div><!-- Tests Screen -->
    <div id="tests-screen" class="hidden max-w-4xl mx-auto">
     <div class="flex items-center justify-between mb-6"><button class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2" onclick="showHome()"> ‚Üê –ì–ª–∞–≤–Ω–∞—è </button>
      <h2 class="text-2xl font-bold text-white neon-text">–¢–µ—Å—Ç—ã</h2>
      <div></div>
     </div><!-- Test Selection -->
     <div id="test-selection" class="grid grid-cols-1 sm:grid-cols-2 gap-4"><!-- Test options will be generated here -->
     </div><!-- Test Game -->
     <div id="test-game" class="hidden">
      <div class="bg-gradient-to-r from-gray-800 to-gray-700 border border-orange-400 rounded-xl p-6 mb-6">
       <h3 class="text-xl font-bold text-white mb-2" id="test-title">–°–æ—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</h3>
       <p class="text-orange-300 mb-4" id="test-instruction">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å–ª–æ–≤–∞ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ</p>
       <div class="text-sm text-gray-400">
        –ó–∞–¥–∞–Ω–∏–µ <span id="test-current">1</span> –∏–∑ <span id="test-total">5</span>
       </div>
      </div><!-- Target Sentence -->
      <div class="bg-gradient-to-r from-gray-800 to-gray-700 border border-cyan-400 rounded-lg p-4 mb-6">
       <h4 class="text-cyan-300 font-bold mb-2">–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ:</h4>
       <p class="text-white text-lg" id="target-translation">–ê–ª–ª–∞—Ö –≤–µ–ª–∏–∫</p>
      </div><!-- Sentence Builder -->
      <div class="sentence-builder" id="sentence-builder">
       <div class="text-gray-400 text-center" id="builder-placeholder">
        –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ —Å–ª–æ–≤–∞ –¥–ª—è —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
       </div>
      </div><!-- Word Bank -->
      <div class="test-word-bank" id="word-bank"><!-- Words will be generated here -->
      </div><!-- Action Buttons -->
      <div class="flex justify-center gap-4 mt-6"><button class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg transition-colors" onclick="clearSentence()"> –û—á–∏—Å—Ç–∏—Ç—å </button> <button class="glow-button px-6 py-3 rounded-lg font-semibold transition-all" onclick="checkSentence()" id="check-button" disabled> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å </button>
      </div><!-- Test Results -->
      <div id="test-results" class="hidden mt-6 p-6 rounded-xl text-center">
       <h3 class="text-2xl font-bold mb-4" id="test-result-title">–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω!</h3>
       <p class="text-lg mb-4" id="test-score">–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: 0 –∏–∑ 5</p><button class="glow-button px-6 py-3 rounded-lg font-semibold" onclick="backToTests()"> –ö —Ç–µ—Å—Ç–∞–º </button>
      </div>
     </div>
    </div><!-- Lesson/Exam Screen -->
    <div id="lesson-screen" class="hidden max-w-2xl mx-auto"><!-- Back Button -->
     <div class="flex items-center justify-between mb-6"><button class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2" onclick="backToLessons()"> ‚Üê –ö —É—Ä–æ–∫–∞–º </button>
      <div class="text-white text-sm"><span id="lesson-title-header">–£—Ä–æ–∫ 1</span>
      </div>
      <div></div>
     </div><!-- Task Container -->
     <div id="task-container" class="task-card bg-white rounded-xl shadow-lg p-8 fade-in"><!-- Task content will be inserted here -->
     </div><!-- Lesson Results -->
     <div id="results-container" class="hidden">
      <div class="task-card rounded-xl shadow-lg p-8 text-center">
       <div class="text-6xl mb-4">
        üéâ
       </div>
       <h2 id="results-title" class="text-2xl font-bold text-white neon-text mb-4">–£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à—ë–Ω!</h2>
       <div id="results-stats" class="text-green-300 mb-6">
        <p>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: <span id="correct-answers" class="font-semibold text-white">0</span> –∏–∑ <span id="total-tasks" class="font-semibold text-white">8</span></p>
       </div>
       <div class="bg-gray-800 border border-cyan-400 rounded-lg p-4 mb-6">
        <h3 class="font-semibold text-cyan-300 mb-2">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å:</h3>
        <div id="review-words" class="text-sm text-gray-300 arabic-text"><!-- Review words will be inserted here -->
        </div>
       </div><button id="back-to-lessons" class="glow-button px-8 py-3 rounded-lg font-semibold transition-all" onclick="backToLessons()"> –ö —É—Ä–æ–∫–∞–º </button>
      </div>
     </div>
    </div>
   </main><!-- Hidden file input for import --> <input type="file" id="import-file" accept=".json" style="display: none;" onchange="handleFileImport(event)">
  </div>
  <script>
        // Motivational Ayahs
        const motivationalAyahs = [
            {
                arabic: "ŸàŸéŸÇŸèŸÑ ÿ±ŸéŸëÿ®ŸêŸë ÿ≤ŸêÿØŸíŸÜŸêŸä ÿπŸêŸÑŸíŸÖŸãÿß",
                translation: "–ò –≥–æ–≤–æ—Ä–∏: –ì–æ—Å–ø–æ–¥–∏ –º–æ–π! –£–º–Ω–æ–∂—å –º–æ–∏ –∑–Ω–∞–Ω–∏—è!",
                reference: "–ö–æ—Ä–∞–Ω 20:114"
            },
            {
                arabic: "ÿßŸÇŸíÿ±Ÿéÿ£Ÿí ÿ®Ÿêÿßÿ≥ŸíŸÖŸê ÿ±Ÿéÿ®ŸêŸëŸÉŸé ÿßŸÑŸéŸëÿ∞ŸêŸä ÿÆŸéŸÑŸéŸÇŸé",
                translation: "–ß–∏—Ç–∞–π –≤–æ –∏–º—è –ì–æ—Å–ø–æ–¥–∞ —Ç–≤–æ–µ–≥–æ, –ö–æ—Ç–æ—Ä—ã–π —Å–æ—Ç–≤–æ—Ä–∏–ª!",
                reference: "–ö–æ—Ä–∞–Ω 96:1"
            },
            {
                arabic: "ŸàŸéŸÖŸéÿß ÿ£ŸèŸàÿ™ŸêŸäÿ™ŸèŸÖ ŸÖŸêŸëŸÜŸé ÿßŸÑŸíÿπŸêŸÑŸíŸÖŸê ÿ•ŸêŸÑŸéŸëÿß ŸÇŸéŸÑŸêŸäŸÑŸãÿß",
                translation: "–ê –¥–∞–Ω–æ –≤–∞–º –∑–Ω–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ –Ω–µ–º–Ω–æ–≥–æ",
                reference: "–ö–æ—Ä–∞–Ω 17:85"
            },
            {
                arabic: "ŸäŸéÿ±ŸíŸÅŸéÿπŸê ÿßŸÑŸÑŸéŸëŸáŸè ÿßŸÑŸéŸëÿ∞ŸêŸäŸÜŸé ÿ¢ŸÖŸéŸÜŸèŸàÿß ŸÖŸêŸÜŸÉŸèŸÖŸí ŸàŸéÿßŸÑŸéŸëÿ∞ŸêŸäŸÜŸé ÿ£ŸèŸàÿ™ŸèŸàÿß ÿßŸÑŸíÿπŸêŸÑŸíŸÖŸé ÿØŸéÿ±Ÿéÿ¨Ÿéÿßÿ™Ÿç",
                translation: "–ê–ª–ª–∞—Ö –≤–æ–∑–≤—ã—à–∞–µ—Ç —Ç–µ—Ö –∏–∑ –≤–∞—Å, –∫–æ—Ç–æ—Ä—ã–µ —É–≤–µ—Ä–æ–≤–∞–ª–∏, –∏ —Ç–µ—Ö, –∫–æ–º—É –¥–∞–Ω–æ –∑–Ω–∞–Ω–∏–µ, –Ω–∞ —Å—Ç–µ–ø–µ–Ω–∏",
                reference: "–ö–æ—Ä–∞–Ω 58:11"
            },
            {
                arabic: "ŸàŸéÿπŸéŸÑŸéŸëŸÖŸé ÿ¢ÿØŸéŸÖŸé ÿßŸÑŸíÿ£Ÿéÿ≥ŸíŸÖŸéÿßÿ°Ÿé ŸÉŸèŸÑŸéŸëŸáŸéÿß",
                translation: "–ò –Ω–∞—É—á–∏–ª –û–Ω –ê–¥–∞–º–∞ –≤—Å–µ–º –∏–º–µ–Ω–∞–º",
                reference: "–ö–æ—Ä–∞–Ω 2:31"
            }
        ];

        let currentAyahIndex = 0;

        // Test sentences for different levels
        const testSentences = {
            basic: [
                // –ö–æ—Ä–∞–Ω–∏—á–µ—Å–∫–∏–µ —Ñ—Ä–∞–∑—ã
                {
                    translation: "–ê–ª–ª–∞—Ö –≤–µ–ª–∏–∫",
                    arabic: ["ÿßŸÑŸÑŸéŸëŸáŸè", "ŸÉŸéÿ®ŸêŸäÿ±Ÿå"],
                    words: ["ÿßŸÑŸÑŸéŸëŸáŸè", "ŸÉŸéÿ®ŸêŸäÿ±Ÿå", "ÿµŸéÿ∫ŸêŸäÿ±Ÿå", "ÿ¨ŸéŸÖŸêŸäŸÑŸå"],
                    type: "quranic"
                },
                {
                    translation: "–í–æ –∏–º—è –ê–ª–ª–∞—Ö–∞",
                    arabic: ["ÿ®Ÿêÿßÿ≥ŸíŸÖŸê", "ÿßŸÑŸÑŸéŸëŸáŸê"],
                    words: ["ÿ®Ÿêÿßÿ≥ŸíŸÖŸê", "ÿßŸÑŸÑŸéŸëŸáŸê", "ŸÅŸêŸä", "ŸÖŸêŸÜŸí"],
                    type: "quranic"
                },
                // –ü–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã
                {
                    translation: "–ö–Ω–∏–≥–∞ –≤ –¥–æ–º–µ",
                    arabic: ["ÿßŸÑŸíŸÉŸêÿ™Ÿéÿßÿ®Ÿè", "ŸÅŸêŸä", "ÿßŸÑŸíÿ®ŸéŸäŸíÿ™Ÿê"],
                    words: ["ÿßŸÑŸíŸÉŸêÿ™Ÿéÿßÿ®Ÿè", "ŸÅŸêŸä", "ÿßŸÑŸíÿ®ŸéŸäŸíÿ™Ÿê", "ÿπŸéŸÑŸéŸâ"],
                    type: "daily"
                },
                {
                    translation: "–û–Ω —á–∏—Ç–∞–ª –∫–Ω–∏–≥—É",
                    arabic: ["ŸáŸèŸàŸé", "ŸÇŸéÿ±Ÿéÿ£Ÿé", "ÿßŸÑŸíŸÉŸêÿ™Ÿéÿßÿ®Ÿé"],
                    words: ["ŸáŸèŸàŸé", "ŸÇŸéÿ±Ÿéÿ£Ÿé", "ÿßŸÑŸíŸÉŸêÿ™Ÿéÿßÿ®Ÿé", "ŸÉŸéÿ™Ÿéÿ®Ÿé"],
                    type: "daily"
                },
                {
                    translation: "–°–æ–ª–Ω—Ü–µ –Ω–∞ –Ω–µ–±–µ",
                    arabic: ["ÿßŸÑÿ¥ŸéŸëŸÖŸíÿ≥Ÿè", "ŸÅŸêŸä", "ÿßŸÑÿ≥ŸéŸëŸÖŸéÿßÿ°Ÿê"],
                    words: ["ÿßŸÑÿ¥ŸéŸëŸÖŸíÿ≥Ÿè", "ŸÅŸêŸä", "ÿßŸÑÿ≥ŸéŸëŸÖŸéÿßÿ°Ÿê", "ÿßŸÑŸíŸÇŸéŸÖŸéÿ±Ÿè"],
                    type: "daily"
                },
                {
                    translation: "–ú—É–∂—á–∏–Ω–∞ –ø–æ—à—ë–ª –≤ –¥–æ–º",
                    arabic: ["ÿßŸÑÿ±ŸéŸëÿ¨ŸèŸÑŸè", "ÿ∞ŸéŸáŸéÿ®Ÿé", "ÿ•ŸêŸÑŸéŸâ", "ÿßŸÑŸíÿ®ŸéŸäŸíÿ™Ÿê"],
                    words: ["ÿßŸÑÿ±ŸéŸëÿ¨ŸèŸÑŸè", "ÿ∞ŸéŸáŸéÿ®Ÿé", "ÿ•ŸêŸÑŸéŸâ", "ÿßŸÑŸíÿ®ŸéŸäŸíÿ™Ÿê", "ÿ¨Ÿéÿßÿ°Ÿé", "ŸÖŸêŸÜŸí"],
                    type: "daily"
                },
                {
                    translation: "–ú–∞–ª—å—á–∏–∫ –µ–ª —Ö–ª–µ–±",
                    arabic: ["ÿßŸÑŸíŸàŸéŸÑŸéÿØŸè", "ÿ£ŸéŸÉŸéŸÑŸé", "ÿßŸÑŸíÿÆŸèÿ®Ÿíÿ≤Ÿé"],
                    words: ["ÿßŸÑŸíŸàŸéŸÑŸéÿØŸè", "ÿ£ŸéŸÉŸéŸÑŸé", "ÿßŸÑŸíÿÆŸèÿ®Ÿíÿ≤Ÿé", "ÿ¥Ÿéÿ±Ÿêÿ®Ÿé"],
                    type: "daily"
                },
                {
                    translation: "–ñ–µ–Ω—â–∏–Ω–∞ –æ—Ç–∫—Ä—ã–ª–∞ –¥–≤–µ—Ä—å",
                    arabic: ["ÿßŸÑŸíŸÖŸéÿ±Ÿíÿ£Ÿéÿ©Ÿè", "ŸÅŸéÿ™Ÿéÿ≠Ÿéÿ™Ÿí", "ÿßŸÑŸíÿ®Ÿéÿßÿ®Ÿé"],
                    words: ["ÿßŸÑŸíŸÖŸéÿ±Ÿíÿ£Ÿéÿ©Ÿè", "ŸÅŸéÿ™Ÿéÿ≠Ÿéÿ™Ÿí", "ÿßŸÑŸíÿ®Ÿéÿßÿ®Ÿé", "ÿ£Ÿéÿ∫ŸíŸÑŸéŸÇŸéÿ™Ÿí"],
                    type: "daily"
                },
                {
                    translation: "–õ—É–Ω–∞ –∫—Ä–∞—Å–∏–≤–∞—è",
                    arabic: ["ÿßŸÑŸíŸÇŸéŸÖŸéÿ±Ÿè", "ÿ¨ŸéŸÖŸêŸäŸÑŸå"],
                    words: ["ÿßŸÑŸíŸÇŸéŸÖŸéÿ±Ÿè", "ÿ¨ŸéŸÖŸêŸäŸÑŸå", "ŸÉŸéÿ®ŸêŸäÿ±Ÿå", "ÿµŸéÿ∫ŸêŸäÿ±Ÿå"],
                    type: "daily"
                },
                {
                    translation: "–û—Ç–µ—Ü —Å —Å—ã–Ω–æ–º",
                    arabic: ["ÿßŸÑŸíÿ£Ÿéÿ®Ÿè", "ŸÖŸéÿπŸé", "ÿßŸÑŸíŸàŸéŸÑŸéÿØŸê"],
                    words: ["ÿßŸÑŸíÿ£Ÿéÿ®Ÿè", "ŸÖŸéÿπŸé", "ÿßŸÑŸíŸàŸéŸÑŸéÿØŸê", "ŸÅŸêŸä"],
                    type: "daily"
                }
            ]
        };

        // Vocabulary data for lessons
        const vocabularyData = {
            1: [
                {arabic: "ÿßŸÑŸÑŸéŸëŸáŸè", translation: "–ê–ª–ª–∞—Ö", type: "noun", root: "ÿß-ŸÑ-Ÿá"},
                {arabic: "ŸáŸèŸàŸé", translation: "–æ–Ω", type: "pronoun", root: "Ÿá-Ÿà"},
                {arabic: "ŸÅŸêŸä", translation: "–≤", type: "preposition", root: "ŸÅ-Ÿä"},
                {arabic: "ŸÖŸêŸÜŸí", translation: "–∏–∑, –æ—Ç", type: "preposition", root: "ŸÖ-ŸÜ"},
                {arabic: "ÿ•ŸêŸÑŸéŸâ", translation: "–∫", type: "preposition", root: "ÿß-ŸÑ-Ÿä"},
                {arabic: "ÿπŸéŸÑŸéŸâ", translation: "–Ω–∞", type: "preposition", root: "ÿπ-ŸÑ-Ÿä"},
                {arabic: "ŸÖŸéÿπŸé", translation: "—Å", type: "preposition", root: "ŸÖ-ÿπ"},
                {arabic: "ŸÑŸéÿß", translation: "–Ω–µ", type: "particle", root: "ŸÑ-ÿß"},
                {arabic: "ŸÜŸéÿπŸéŸÖŸí", translation: "–¥–∞", type: "particle", root: "ŸÜ-ÿπ-ŸÖ"},
                {arabic: "ŸÉŸéŸäŸíŸÅŸé", translation: "–∫–∞–∫", type: "interrogative", root: "ŸÉ-Ÿä-ŸÅ"},
                {arabic: "ÿ£ŸéŸäŸíŸÜŸé", translation: "–≥–¥–µ", type: "interrogative", root: "ÿß-Ÿä-ŸÜ"},
                {arabic: "ŸÖŸéÿ™ŸéŸâ", translation: "–∫–æ–≥–¥–∞", type: "interrogative", root: "ŸÖ-ÿ™-Ÿä"}
            ],
            2: [
                {arabic: "ÿ®ŸéŸäŸíÿ™Ÿå", translation: "–¥–æ–º", type: "noun", root: "ÿ®-Ÿä-ÿ™"},
                {arabic: "ŸÉŸêÿ™Ÿéÿßÿ®Ÿå", translation: "–∫–Ω–∏–≥–∞", type: "noun", root: "ŸÉ-ÿ™-ÿ®"},
                {arabic: "ŸÇŸéŸÑŸéŸÖŸå", translation: "—Ä—É—á–∫–∞", type: "noun", root: "ŸÇ-ŸÑ-ŸÖ"},
                {arabic: "ŸÖŸéÿßÿ°Ÿå", translation: "–≤–æ–¥–∞", type: "noun", root: "ŸÖ-ÿß"},
                {arabic: "ÿÆŸèÿ®Ÿíÿ≤Ÿå", translation: "—Ö–ª–µ–±", type: "noun", root: "ÿÆ-ÿ®-ÿ≤"},
                {arabic: "ÿ®Ÿéÿßÿ®Ÿå", translation: "–¥–≤–µ—Ä—å", type: "noun", root: "ÿ®-Ÿà-ÿ®"},
                {arabic: "ŸÜŸèŸàÿ±Ÿå", translation: "—Å–≤–µ—Ç", type: "noun", root: "ŸÜ-Ÿà-ÿ±"},
                {arabic: "ŸäŸéŸàŸíŸÖŸå", translation: "–¥–µ–Ω—å", type: "noun", root: "Ÿä-Ÿà-ŸÖ"},
                {arabic: "ŸÑŸéŸäŸíŸÑŸéÿ©Ÿå", translation: "–Ω–æ—á—å", type: "noun", root: "ŸÑ-Ÿä-ŸÑ"},
                {arabic: "ÿ¥ŸéŸÖŸíÿ≥Ÿå", translation: "—Å–æ–ª–Ω—Ü–µ", type: "noun", root: "ÿ¥-ŸÖ-ÿ≥"},
                {arabic: "ŸÇŸéŸÖŸéÿ±Ÿå", translation: "–ª—É–Ω–∞", type: "noun", root: "ŸÇ-ŸÖ-ÿ±"},
                {arabic: "ÿ≥ŸéŸÖŸéÿßÿ°Ÿå", translation: "–Ω–µ–±–æ", type: "noun", root: "ÿ≥-ŸÖ-Ÿà"}
            ],
            3: [
                {arabic: "ŸÉŸéÿ™Ÿéÿ®Ÿé", translation: "–ø–∏—Å–∞–ª", type: "verb", root: "ŸÉ-ÿ™-ÿ®"},
                {arabic: "ŸÇŸéÿ±Ÿéÿ£Ÿé", translation: "—á–∏—Ç–∞–ª", type: "verb", root: "ŸÇ-ÿ±-ÿß"},
                {arabic: "ÿ∞ŸéŸáŸéÿ®Ÿé", translation: "–ø–æ—à—ë–ª", type: "verb", root: "ÿ∞-Ÿá-ÿ®"},
                {arabic: "ÿ¨Ÿéÿßÿ°Ÿé", translation: "–ø—Ä–∏—à—ë–ª", type: "verb", root: "ÿ¨-Ÿä-ÿß"},
                {arabic: "ÿ£ŸéŸÉŸéŸÑŸé", translation: "–µ–ª", type: "verb", root: "ÿß-ŸÉ-ŸÑ"},
                {arabic: "ÿ¥Ÿéÿ±Ÿêÿ®Ÿé", translation: "–ø–∏–ª", type: "verb", root: "ÿ¥-ÿ±-ÿ®"},
                {arabic: "ŸÜŸéÿßŸÖŸé", translation: "—Å–ø–∞–ª", type: "verb", root: "ŸÜ-Ÿà-ŸÖ"},
                {arabic: "ŸÇŸéÿßŸÖŸé", translation: "–≤—Å—Ç–∞–ª", type: "verb", root: "ŸÇ-Ÿà-ŸÖ"},
                {arabic: "ÿ¨ŸéŸÑŸéÿ≥Ÿé", translation: "—Å–µ–ª", type: "verb", root: "ÿ¨-ŸÑ-ÿ≥"},
                {arabic: "ŸÅŸéÿ™Ÿéÿ≠Ÿé", translation: "–æ—Ç–∫—Ä—ã–ª", type: "verb", root: "ŸÅ-ÿ™-ÿ≠"},
                {arabic: "ÿ£Ÿéÿ∫ŸíŸÑŸéŸÇŸé", translation: "–∑–∞–∫—Ä—ã–ª", type: "verb", root: "ÿ∫-ŸÑ-ŸÇ"},
                {arabic: "ŸÜŸéÿ∏Ÿéÿ±Ÿé", translation: "–ø–æ—Å–º–æ—Ç—Ä–µ–ª", type: "verb", root: "ŸÜ-ÿ∏-ÿ±"}
            ]
        };

        // State
        let currentLesson = null;
        let currentTaskIndex = 0;
        let correctAnswers = 0;
        let userAnswers = [];
        let currentAnswer = null;
        let userProgress = {
            completedLessons: new Set(),
            passedExams: new Set(),
            currentLesson: 1
        };
        let learnedWordsPerLesson = new Map();
        let incorrectTasks = [];
        let isReviewMode = false;

        // Test state
        let currentTest = null;
        let currentTestIndex = 0;
        let testCorrectAnswers = 0;
        let currentSentence = [];

        // Local Storage functions
        function saveProgress() {
            const progressData = {
                completedLessons: Array.from(userProgress.completedLessons),
                passedExams: Array.from(userProgress.passedExams),
                currentLesson: userProgress.currentLesson,
                learnedWords: Array.from(learnedWordsPerLesson.entries()).map(([key, value]) => [key, Array.from(value)]),
                timestamp: new Date().toISOString()
            };
            
            try {
                localStorage.setItem('arabic-quran-progress', JSON.stringify(progressData));
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞', 'error');
            }
        }

        function loadProgress() {
            try {
                const saved = localStorage.getItem('arabic-quran-progress');
                if (saved) {
                    const progressData = JSON.parse(saved);
                    userProgress.completedLessons = new Set(progressData.completedLessons || []);
                    userProgress.passedExams = new Set(progressData.passedExams || []);
                    userProgress.currentLesson = progressData.currentLesson || 1;
                    
                    learnedWordsPerLesson.clear();
                    if (progressData.learnedWords) {
                        progressData.learnedWords.forEach(([key, value]) => {
                            learnedWordsPerLesson.set(key, new Set(value));
                        });
                    }
                    
                    updateLessonsDisplay();
                    updateOverallProgress();
                    updateHomeProgress();
                }
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞', 'error');
            }
        }

        function exportProgress() {
            const progressData = {
                completedLessons: Array.from(userProgress.completedLessons),
                passedExams: Array.from(userProgress.passedExams),
                currentLesson: userProgress.currentLesson,
                learnedWords: Array.from(learnedWordsPerLesson.entries()).map(([key, value]) => [key, Array.from(value)]),
                timestamp: new Date().toISOString(),
                version: "1.0"
            };
            
            const dataStr = JSON.stringify(progressData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `arabic-quran-progress-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showToast('–ü—Ä–æ–≥—Ä–µ—Å—Å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!');
        }

        function importProgress() {
            document.getElementById('import-file').click();
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const progressData = JSON.parse(e.target.result);
                    
                    if (progressData.version && progressData.completedLessons !== undefined) {
                        userProgress.completedLessons = new Set(progressData.completedLessons || []);
                        userProgress.passedExams = new Set(progressData.passedExams || []);
                        userProgress.currentLesson = progressData.currentLesson || 1;
                        
                        learnedWordsPerLesson.clear();
                        if (progressData.learnedWords) {
                            progressData.learnedWords.forEach(([key, value]) => {
                                learnedWordsPerLesson.set(key, new Set(value));
                            });
                        }
                        
                        saveProgress();
                        updateLessonsDisplay();
                        updateOverallProgress();
                        updateHomeProgress();
                        
                        showToast('–ü—Ä–æ–≥—Ä–µ—Å—Å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!');
                    } else {
                        showToast('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞', 'error');
                    }
                } catch (error) {
                    showToast('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞', 'error');
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type === 'error' ? 'bg-red-600' : ''}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // Generate lessons grid
        function generateLessonsGrid() {
            const grid = document.getElementById('lessons-grid');
            if (!grid) return;
            
            grid.innerHTML = '';

            for (let i = 1; i <= 20; i++) {
                const isExam = i % 10 === 0;
                const isUnlocked = i === 1 || userProgress.completedLessons.has(i - 1) || userProgress.passedExams.has(i - 1);
                const isCompleted = userProgress.completedLessons.has(i);
                const isPassed = userProgress.passedExams.has(i);
                
                const card = document.createElement('div');
                card.className = `lesson-card rounded-lg p-4 cursor-pointer ${
                    isCompleted || isPassed ? 'completed' : ''
                } ${!isUnlocked ? 'locked' : ''}`;
                
                if (isExam) {
                    card.classList.add('exam-card');
                }
                
                const title = isExam ? `–≠–∫–∑–∞–º–µ–Ω ${i / 10}` : `–£—Ä–æ–∫ ${i}`;
                const description = isExam ? `–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞–Ω–∏–π —É—Ä–æ–∫–æ–≤ ${i - 9}-${i - 1}` : `12 –Ω–æ–≤—ã—Ö —Å–ª–æ–≤`;
                
                card.innerHTML = `
                    <div class="text-center">
                        <div class="text-2xl mb-2">
                            ${isExam ? 'üìã' : 'üìñ'}
                            ${isCompleted || isPassed ? '‚úÖ' : ''}
                            ${!isUnlocked ? 'üîí' : ''}
                        </div>
                        <h3 class="font-bold text-white mb-1">${title}</h3>
                        <p class="text-sm text-gray-300">${description}</p>
                        ${isExam ? '<div class="text-xs text-orange-300 mt-2">–¢—Ä–µ–±—É–µ—Ç—Å—è 70% –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è</div>' : ''}
                    </div>
                `;
                
                if (isUnlocked) {
                    card.addEventListener('click', () => {
                        startLesson(i, isExam);
                    });
                }
                
                grid.appendChild(card);
            }
        }

        // Start lesson
        function startLesson(lessonId, isExam) {
            const lessonWords = vocabularyData[lessonId] || generateExtendedVocabulary(lessonId);
            
            currentLesson = {
                id: lessonId,
                type: isExam ? 'exam' : 'lesson',
                title: isExam ? `–≠–∫–∑–∞–º–µ–Ω ${lessonId / 10}` : `–£—Ä–æ–∫ ${lessonId}`,
                description: isExam ? `–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞–Ω–∏–π —É—Ä–æ–∫–æ–≤ ${lessonId - 9}-${lessonId - 1}` : `${lessonWords.length} –Ω–æ–≤—ã—Ö —Å–ª–æ–≤`,
                newWords: lessonWords,
                tasks: isExam ? generateExamTasks(lessonId) : generateLessonTasks(lessonId, lessonWords)
            };
            
            currentTaskIndex = 0;
            correctAnswers = 0;
            userAnswers = [];
            incorrectTasks = [];
            isReviewMode = false;
            
            document.getElementById('lesson-selection').classList.add('hidden');
            document.getElementById('lesson-screen').classList.remove('hidden');
            
            document.getElementById('lesson-title-header').textContent = currentLesson.title;
            
            renderCurrentTask();
        }

        // Generate extended vocabulary for lessons beyond predefined ones
        function generateExtendedVocabulary(lessonId) {
            const baseWords = [
                {arabic: "ÿ±Ÿéÿ¨ŸèŸÑŸå", translation: "–º—É–∂—á–∏–Ω–∞", type: "noun", root: "ÿ±-ÿ¨-ŸÑ"},
                {arabic: "ÿßŸÖŸíÿ±Ÿéÿ£Ÿéÿ©Ÿå", translation: "–∂–µ–Ω—â–∏–Ω–∞", type: "noun", root: "ŸÖ-ÿ±-ÿß"},
                {arabic: "ŸàŸéŸÑŸéÿØŸå", translation: "–º–∞–ª—å—á–∏–∫", type: "noun", root: "Ÿà-ŸÑ-ÿØ"},
                {arabic: "ÿ®ŸêŸÜŸíÿ™Ÿå", translation: "–¥–µ–≤–æ—á–∫–∞", type: "noun", root: "ÿ®-ŸÜ-ÿ™"},
                {arabic: "ÿ£Ÿéÿ®Ÿå", translation: "–æ—Ç–µ—Ü", type: "noun", root: "ÿß-ÿ®"},
                {arabic: "ÿ£ŸèŸÖŸåŸë", translation: "–º–∞—Ç—å", type: "noun", root: "ÿß-ŸÖ"},
                {arabic: "ÿ£ŸéÿÆŸå", translation: "–±—Ä–∞—Ç", type: "noun", root: "ÿß-ÿÆ"},
                {arabic: "ÿ£ŸèÿÆŸíÿ™Ÿå", translation: "—Å–µ—Å—Ç—Ä–∞", type: "noun", root: "ÿß-ÿÆ-ÿ™"},
                {arabic: "ŸÉŸéÿ®ŸêŸäÿ±Ÿå", translation: "–±–æ–ª—å—à–æ–π", type: "adjective", root: "ŸÉ-ÿ®-ÿ±"},
                {arabic: "ÿµŸéÿ∫ŸêŸäÿ±Ÿå", translation: "–º–∞–ª–µ–Ω—å–∫–∏–π", type: "adjective", root: "ÿµ-ÿ∫-ÿ±"},
                {arabic: "ÿ¨ŸéŸÖŸêŸäŸÑŸå", translation: "–∫—Ä–∞—Å–∏–≤—ã–π", type: "adjective", root: "ÿ¨-ŸÖ-ŸÑ"},
                {arabic: "ÿ∑ŸéŸàŸêŸäŸÑŸå", translation: "–¥–ª–∏–Ω–Ω—ã–π", type: "adjective", root: "ÿ∑-Ÿà-ŸÑ"}
            ];
            
            return baseWords.slice(0, 12);
        }

        // Generate lesson tasks
        function generateLessonTasks(lessonId, newWords) {
            const tasks = [];
            
            // Word introduction tasks
            newWords.forEach((word, index) => {
                tasks.push({
                    id: tasks.length + 1,
                    type: "word_introduction",
                    question: "–ù–æ–≤–æ–µ —Å–ª–æ–≤–æ:",
                    word: word,
                    explanation: "–ó–∞–ø–æ–º–Ω–∏—Ç–µ —ç—Ç–æ —Å–ª–æ–≤–æ"
                });
            });
            
            // Translation tasks
            newWords.forEach((word, index) => {
                const otherWords = newWords.filter(w => w.arabic !== word.arabic).slice(0, 3);
                const allOptions = [word, ...otherWords];
                const shuffledOptions = [...allOptions].sort(() => Math.random() - 0.5);
                const correctIndex = shuffledOptions.findIndex(w => w.arabic === word.arabic);
                
                tasks.push({
                    id: tasks.length + 1,
                    type: "translation",
                    question: "–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ:",
                    arabic: word.arabic,
                    options: shuffledOptions.map(w => w.translation),
                    correct: correctIndex,
                    explanation: `${word.arabic} - ${word.translation}`
                });
            });
            
            return tasks;
        }

        // Generate exam tasks
        function generateExamTasks(examId) {
            const startLesson = examId - 9;
            const endLesson = examId - 1;
            const allWords = [];
            
            for (let i = startLesson; i <= endLesson; i++) {
                const lessonWords = vocabularyData[i] || generateExtendedVocabulary(i);
                allWords.push(...lessonWords);
            }
            
            const tasks = [];
            
            for (let i = 0; i < 15; i++) {
                const word = allWords[i % allWords.length];
                const otherWords = allWords.filter(w => w.arabic !== word.arabic && w.type === word.type).slice(0, 3);
                const allOptions = [word, ...otherWords];
                const shuffledOptions = [...allOptions].sort(() => Math.random() - 0.5);
                const correctIndex = shuffledOptions.findIndex(w => w.arabic === word.arabic);
                
                tasks.push({
                    id: i + 1,
                    type: "translation",
                    question: "–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ:",
                    arabic: word.arabic,
                    options: shuffledOptions.map(w => w.translation),
                    correct: correctIndex,
                    explanation: `${word.arabic} - ${word.translation}`
                });
            }
            
            return tasks;
        }

        // Render current task
        function renderCurrentTask() {
            const task = currentLesson.tasks[currentTaskIndex];
            const container = document.getElementById('task-container');
            
            container.innerHTML = '';
            container.className = 'task-card bg-white rounded-xl shadow-lg p-8 fade-in';
            
            if (task.type === 'word_introduction') {
                renderWordIntroduction(task, container);
            } else if (task.type === 'translation') {
                renderTranslationTask(task, container);
            }
        }

        function renderWordIntroduction(task, container) {
            container.innerHTML = `
                <div class="text-center">
                    <div class="mb-4">
                        <span class="text-sm text-green-300">${currentLesson.title}</span>
                        <div class="text-xs text-gray-400">${currentTaskIndex + 1} / ${currentLesson.tasks.length}</div>
                    </div>
                    <h2 class="text-2xl font-semibold text-white mb-6">–ù–æ–≤–æ–µ —Å–ª–æ–≤–æ:</h2>
                    
                    <div class="bg-gradient-to-r from-gray-800 to-gray-700 border border-green-400 rounded-xl p-6 mb-6 max-w-md mx-auto">
                        <div class="arabic-text text-4xl text-white mb-3">${task.word.arabic}</div>
                        <div class="text-3xl text-green-300 mb-2">${task.word.translation}</div>
                        <div class="text-lg text-gray-400">${getTypeTranslation(task.word.type)}</div>
                        <div class="text-sm text-cyan-300 mt-2">–ö–æ—Ä–µ–Ω—å: ${task.word.root}</div>
                    </div>
                    
                    <button class="glow-button px-8 py-3 rounded-lg font-semibold transition-all text-lg" onclick="continueToNext()">
                        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
                    </button>
                </div>
            `;
        }

        function renderTranslationTask(task, container) {
            container.innerHTML = `
                <div class="text-center">
                    <div class="mb-4">
                        <span class="text-lg text-green-300">${currentLesson.title}</span>
                        <div class="text-sm text-gray-400">${currentTaskIndex + 1} / ${currentLesson.tasks.length}</div>
                    </div>
                    <h2 class="text-2xl font-semibold text-white mb-6">${task.question}</h2>
                    <div class="arabic-text bg-gradient-to-r from-gray-800 to-gray-700 border border-green-400 rounded-lg p-6 mb-8 text-center text-white text-3xl">
                        ${task.arabic}
                    </div>
                    <div class="grid grid-cols-1 gap-4">
                        ${task.options.map((option, index) => `
                            <button class="option-button rounded-lg p-4 text-left transition-all text-lg" 
                                    onclick="selectAnswer(${index})">
                                ${option}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function getTypeTranslation(type) {
            const translations = {
                'noun': '–°—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ',
                'verb': '–ì–ª–∞–≥–æ–ª',
                'adjective': '–ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ',
                'preposition': '–ü—Ä–µ–¥–ª–æ–≥',
                'pronoun': '–ú–µ—Å—Ç–æ–∏–º–µ–Ω–∏–µ',
                'particle': '–ß–∞—Å—Ç–∏—Ü–∞',
                'interrogative': '–í–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ'
            };
            return translations[type] || type;
        }

        // Answer handling
        function selectAnswer(answerIndex) {
            currentAnswer = answerIndex;
            const task = currentLesson.tasks[currentTaskIndex];
            
            const buttons = document.querySelectorAll('.option-button');
            buttons.forEach((btn, index) => {
                btn.classList.remove('correct-answer', 'incorrect-answer');
                if (index === answerIndex) {
                    if (index === task.correct) {
                        btn.classList.add('correct-answer');
                    } else {
                        btn.classList.add('incorrect-answer');
                    }
                }
                if (index === task.correct && index !== answerIndex) {
                    btn.classList.add('correct-answer');
                }
                btn.disabled = true;
            });

            storeAnswer(task, answerIndex);
            
            // Quick feedback and continue
            setTimeout(() => {
                continueToNext();
            }, 500);
        }

        function storeAnswer(task, answer) {
            const isCorrect = answer === task.correct;
            
            if (isCorrect) {
                correctAnswers++;
            } else {
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∑–∞–¥–∞—á—É –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è —É—Ä–æ–∫–æ–≤, –Ω–µ —ç–∫–∑–∞–º–µ–Ω–æ–≤)
                if (currentLesson.type === 'lesson' && !incorrectTasks.some(t => t.id === task.id)) {
                    incorrectTasks.push({...task});
                }
            }
            
            userAnswers.push({
                taskId: task.id,
                userAnswer: answer,
                correctAnswer: task.correct,
                isCorrect: isCorrect
            });
        }

        function continueToNext() {
            currentTaskIndex++;
            
            if (currentTaskIndex >= currentLesson.tasks.length) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
                if (incorrectTasks.length > 0 && !isReviewMode && currentLesson.type === 'lesson') {
                    startReviewMode();
                } else {
                    completeLesson();
                }
            } else {
                renderCurrentTask();
            }
        }

        function startReviewMode() {
            isReviewMode = true;
            currentLesson.tasks = [...incorrectTasks];
            incorrectTasks = [];
            currentTaskIndex = 0;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–µ–∂–∏–º–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
            showToast('–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã');
            
            renderCurrentTask();
        }

        function completeLesson() {
            const isExam = currentLesson.type === 'exam';
            const passingScore = isExam ? 0.7 : 0.5;
            const score = correctAnswers / currentLesson.tasks.length;
            const passed = score >= passingScore;
            
            if (passed) {
                if (isExam) {
                    userProgress.passedExams.add(currentLesson.id);
                } else {
                    userProgress.completedLessons.add(currentLesson.id);
                    
                    // Mark words as learned
                    if (!learnedWordsPerLesson.has(currentLesson.id)) {
                        learnedWordsPerLesson.set(currentLesson.id, new Set());
                    }
                    currentLesson.newWords.forEach(word => {
                        learnedWordsPerLesson.get(currentLesson.id).add(word.arabic);
                    });
                }
                
                saveProgress();
            }
            
            showResults(passed, isExam);
        }

        function showResults(passed, isExam) {
            document.getElementById('task-container').classList.add('hidden');
            document.getElementById('results-container').classList.remove('hidden');
            
            const resultsTitle = document.getElementById('results-title');
            
            if (isExam) {
                resultsTitle.textContent = passed ? '–≠–∫–∑–∞–º–µ–Ω —Å–¥–∞–Ω!' : '–≠–∫–∑–∞–º–µ–Ω –Ω–µ —Å–¥–∞–Ω';
                resultsTitle.className = passed ? 'text-2xl font-bold text-green-400 neon-text mb-4' : 'text-2xl font-bold text-red-400 mb-4';
            } else {
                resultsTitle.textContent = passed ? '–£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à—ë–Ω!' : '–£—Ä–æ–∫ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω';
                resultsTitle.className = passed ? 'text-2xl font-bold text-green-400 neon-text mb-4' : 'text-2xl font-bold text-red-400 mb-4';
            }
            
            document.getElementById('correct-answers').textContent = correctAnswers;
            document.getElementById('total-tasks').textContent = currentLesson.tasks.length;
            
            const reviewWords = document.getElementById('review-words');
            const incorrectAnswers = userAnswers.filter(answer => !answer.isCorrect);
            
            if (incorrectAnswers.length === 0) {
                reviewWords.textContent = '–í—Å–µ –æ—Ç–≤–µ—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!';
            } else {
                reviewWords.textContent = '–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ —Å–ª–æ–≤–∞ –∏–∑ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤';
            }
            
            updateOverallProgress();
            updateHomeProgress();
        }

        // Tests functionality
        function showTests() {
            document.getElementById('home-screen').classList.add('hidden');
            document.getElementById('tests-screen').classList.remove('hidden');
            document.getElementById('test-selection').classList.remove('hidden');
            document.getElementById('test-game').classList.add('hidden');
            
            generateTestSelection();
        }

        function generateTestSelection() {
            const container = document.getElementById('test-selection');
            const learnedLessons = userProgress.completedLessons.size;
            
            if (learnedLessons === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="text-6xl mb-4">üß©</div>
                        <h3 class="text-xl text-white mb-2">–¢–µ—Å—Ç—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</h3>
                        <p class="text-gray-400 mb-6">–ü—Ä–æ–π–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–∫–æ–≤, —á—Ç–æ–±—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã</p>
                        <button class="glow-button px-6 py-3 rounded-lg font-semibold" onclick="showLessons()">
                            –ö —É—Ä–æ–∫–∞–º
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="bg-gradient-to-br from-orange-600 to-orange-800 text-white rounded-xl p-6 cursor-pointer transition-all hover:from-orange-500 hover:to-orange-700" onclick="startTest('basic')">
                    <div class="text-3xl mb-3">üî§</div>
                    <h3 class="text-lg font-bold mb-2">–ë–∞–∑–æ–≤—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</h3>
                    <p class="text-sm text-orange-200">–°–æ—Å—Ç–∞–≤–ª—è–π—Ç–µ –ø—Ä–æ—Å—Ç—ã–µ —Ñ—Ä–∞–∑—ã –∏–∑ –∏–∑—É—á–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤</p>
                    <div class="mt-3 text-sm text-orange-300">
                        5 –∑–∞–¥–∞–Ω–∏–π –Ω–∞ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-gray-600 to-gray-800 text-white rounded-xl p-6 opacity-50">
                    <div class="text-3xl mb-3">üîí</div>
                    <h3 class="text-lg font-bold mb-2">–°–ª–æ–∂–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</h3>
                    <p class="text-sm text-gray-300">–°–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ</p>
                    <div class="mt-3 text-sm text-gray-400">
                        –¢—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª—å—à–µ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö —É—Ä–æ–∫–æ–≤
                    </div>
                </div>
            `;
        }

        function startTest(testType) {
            // –§–∏–ª—å—Ç—Ä—É–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑—É—á–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤
            const availableSentences = testSentences[testType].filter(sentence => {
                return sentence.arabic.every(word => isWordLearned(word));
            });
            
            if (availableSentences.length < 5) {
                showToast('–ò–∑—É—á–∏—Ç–µ –±–æ–ª—å—à–µ —Å–ª–æ–≤ –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞', 'error');
                return;
            }
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ 5 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
            const selectedSentences = availableSentences
                .sort(() => Math.random() - 0.5)
                .slice(0, 5);
            
            currentTest = {
                type: testType,
                sentences: selectedSentences,
                currentIndex: 0,
                correctAnswers: 0
            };
            
            currentTestIndex = 0;
            testCorrectAnswers = 0;
            currentSentence = [];
            
            document.getElementById('test-selection').classList.add('hidden');
            document.getElementById('test-game').classList.remove('hidden');
            
            renderCurrentTestTask();
        }

        function isWordLearned(word) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑—É—á–µ–Ω–æ –ª–∏ —Å–ª–æ–≤–æ –≤ –ª—é–±–æ–º –∏–∑ –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö —É—Ä–æ–∫–æ–≤
            for (let lessonId of userProgress.completedLessons) {
                if (lessonId % 10 !== 0) { // –ò—Å–∫–ª—é—á–∞–µ–º —ç–∫–∑–∞–º–µ–Ω—ã
                    const lessonWords = vocabularyData[lessonId] || generateExtendedVocabulary(lessonId);
                    if (lessonWords.some(w => w.arabic === word)) {
                        return true;
                    }
                }
            }
            return false;
        }

        function renderCurrentTestTask() {
            const sentence = currentTest.sentences[currentTestIndex];
            
            document.getElementById('test-current').textContent = currentTestIndex + 1;
            document.getElementById('test-total').textContent = currentTest.sentences.length;
            document.getElementById('target-translation').textContent = sentence.translation;
            
            // Clear sentence builder
            currentSentence = [];
            updateSentenceBuilder();
            
            // Render word bank
            const wordBank = document.getElementById('word-bank');
            wordBank.innerHTML = sentence.words.map((word, index) => `
                <div class="test-word" data-word="${word}" onclick="addWordToSentence('${word}', ${index})">
                    ${word}
                </div>
            `).join('');
            
            updateCheckButton();
        }

        function addWordToSentence(word, index) {
            const wordElement = document.querySelector(`[data-word="${word}"]`);
            if (wordElement.classList.contains('used')) return;
            
            currentSentence.push(word);
            wordElement.classList.add('used');
            
            updateSentenceBuilder();
            updateCheckButton();
        }

        function removeWordFromSentence(index) {
            const word = currentSentence[index];
            currentSentence.splice(index, 1);
            
            // Re-enable word in bank
            const wordElement = document.querySelector(`[data-word="${word}"]`);
            if (wordElement) {
                wordElement.classList.remove('used');
            }
            
            updateSentenceBuilder();
            updateCheckButton();
        }

        function updateSentenceBuilder() {
            const builder = document.getElementById('sentence-builder');
            const placeholder = document.getElementById('builder-placeholder');
            
            if (currentSentence.length === 0) {
                builder.classList.remove('has-words');
                placeholder.style.display = 'block';
                builder.innerHTML = '<div class="text-gray-400 text-center" id="builder-placeholder">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ —Å–ª–æ–≤–∞ –¥–ª—è —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</div>';
            } else {
                builder.classList.add('has-words');
                builder.innerHTML = currentSentence.map((word, index) => `
                    <div class="sentence-word" onclick="removeWordFromSentence(${index})">
                        ${word}
                    </div>
                `).join('');
            }
        }

        function updateCheckButton() {
            const checkButton = document.getElementById('check-button');
            checkButton.disabled = currentSentence.length === 0;
            checkButton.style.opacity = currentSentence.length === 0 ? '0.5' : '1';
        }

        function clearSentence() {
            // Re-enable all words in the current word bank
            const wordBank = document.getElementById('word-bank');
            wordBank.querySelectorAll('.test-word').forEach(word => {
                word.classList.remove('used');
            });
            
            currentSentence = [];
            updateSentenceBuilder();
            updateCheckButton();
        }

        function checkSentence() {
            const sentence = currentTest.sentences[currentTestIndex];
            const isCorrect = JSON.stringify(currentSentence) === JSON.stringify(sentence.arabic);
            
            if (isCorrect) {
                testCorrectAnswers++;
                showToast('–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ú–∞—à–∞–ª–ª–∞—Ö!');
            } else {
                showToast('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ' + sentence.arabic.join(' '), 'error');
            }
            
            setTimeout(() => {
                currentTestIndex++;
                
                if (currentTestIndex >= currentTest.sentences.length) {
                    showTestResults();
                } else {
                    renderCurrentTestTask();
                }
            }, 2000);
        }

        function showTestResults() {
            document.getElementById('test-game').classList.add('hidden');
            
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.classList.remove('hidden');
            
            const percentage = (testCorrectAnswers / currentTest.sentences.length) * 100;
            
            if (percentage >= 70) {
                resultsDiv.className = 'mt-6 p-6 rounded-xl text-center bg-gradient-to-r from-green-800 to-green-600';
                document.getElementById('test-result-title').textContent = '–û—Ç–ª–∏—á–Ω–æ!';
                document.getElementById('test-result-title').className = 'text-2xl font-bold mb-4 text-green-300';
            } else {
                resultsDiv.className = 'mt-6 p-6 rounded-xl text-center bg-gradient-to-r from-red-800 to-red-600';
                document.getElementById('test-result-title').textContent = '–ù—É–∂–Ω–æ –±–æ–ª—å—à–µ –ø—Ä–∞–∫—Ç–∏–∫–∏';
                document.getElementById('test-result-title').className = 'text-2xl font-bold mb-4 text-red-300';
            }
            
            document.getElementById('test-score').textContent = `–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: ${testCorrectAnswers} –∏–∑ ${currentTest.sentences.length}`;
        }

        function backToTests() {
            document.getElementById('test-results').classList.add('hidden');
            document.getElementById('test-selection').classList.remove('hidden');
            document.getElementById('test-game').classList.add('hidden');
        }

        // Navigation functions
        function showHome() {
            document.getElementById('home-screen').classList.remove('hidden');
            document.getElementById('lesson-selection').classList.add('hidden');
            document.getElementById('dictionary-screen').classList.add('hidden');
            document.getElementById('tests-screen').classList.add('hidden');
            document.getElementById('lesson-screen').classList.add('hidden');
            document.getElementById('results-container').classList.add('hidden');
            
            updateHomeProgress();
        }

        function showLessons() {
            document.getElementById('home-screen').classList.add('hidden');
            document.getElementById('lesson-selection').classList.remove('hidden');
            document.getElementById('dictionary-screen').classList.add('hidden');
            document.getElementById('tests-screen').classList.add('hidden');
            
            generateLessonsGrid();
        }

        function showDictionary() {
            document.getElementById('home-screen').classList.add('hidden');
            document.getElementById('lesson-selection').classList.add('hidden');
            document.getElementById('dictionary-screen').classList.remove('hidden');
            document.getElementById('tests-screen').classList.add('hidden');
            
            generateDictionary();
        }

        function generateDictionary() {
            const learnedWords = [];
            
            userProgress.completedLessons.forEach(lessonId => {
                if (lessonId % 10 !== 0) {
                    const lessonWords = vocabularyData[lessonId] || generateExtendedVocabulary(lessonId);
                    learnedWords.push(...lessonWords.map(word => ({...word, lessonId})));
                }
            });
            
            document.getElementById('dict-word-count').textContent = learnedWords.length;
            renderDictionary(learnedWords);
            setupDictionaryFilters(learnedWords);
        }

        function renderDictionary(words) {
            const container = document.getElementById('dictionary-content');
            
            if (words.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="text-6xl mb-4">üìö</div>
                        <h3 class="text-xl text-white mb-2">–°–ª–æ–≤–∞—Ä—å –ø—É—Å—Ç</h3>
                        <p class="text-gray-400 mb-6">–ü—Ä–æ–π–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–∫–æ–≤, —á—Ç–æ–±—ã –ø–æ–ø–æ–ª–Ω–∏—Ç—å —Å–ª–æ–≤–∞—Ä—å</p>
                        <button class="glow-button px-6 py-3 rounded-lg font-semibold" onclick="showLessons()">
                            –ù–∞—á–∞—Ç—å –∏–∑—É—á–µ–Ω–∏–µ
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = words.map((word, index) => `
                <div class="dictionary-card" onclick="flipCard(${index})">
                    <div class="card-inner" id="card-${index}">
                        <div class="card-front">
                            <div class="arabic-text text-2xl text-white mb-2">${word.arabic}</div>
                            <div class="text-xs text-gray-400">${getTypeTranslation(word.type)}</div>
                        </div>
                        <div class="card-back">
                            <div class="text-lg text-white mb-2">${word.translation}</div>
                            <div class="text-xs text-cyan-400">–ö–æ—Ä–µ–Ω—å: ${word.root}</div>
                            <div class="text-xs text-gray-400 mt-1">–£—Ä–æ–∫ ${word.lessonId}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function flipCard(index) {
            const card = document.getElementById(`card-${index}`).parentElement;
            card.classList.toggle('flipped');
        }

        function setupDictionaryFilters(allWords) {
            const searchInput = document.getElementById('search-input');
            const typeFilter = document.getElementById('type-filter');
            
            function filterWords() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedType = typeFilter.value;
                
                let filteredWords = allWords;
                
                if (searchTerm) {
                    filteredWords = filteredWords.filter(word => 
                        word.arabic.includes(searchTerm) || 
                        word.translation.toLowerCase().includes(searchTerm)
                    );
                }
                
                if (selectedType) {
                    filteredWords = filteredWords.filter(word => word.type === selectedType);
                }
                
                renderDictionary(filteredWords);
            }
            
            searchInput.addEventListener('input', filterWords);
            typeFilter.addEventListener('change', filterWords);
        }

        function backToLessons() {
            document.getElementById('lesson-screen').classList.add('hidden');
            document.getElementById('lesson-selection').classList.remove('hidden');
            document.getElementById('results-container').classList.add('hidden');
            document.getElementById('task-container').classList.remove('hidden');
            
            generateLessonsGrid();
        }

        function changeAyah() {
            currentAyahIndex = (currentAyahIndex + 1) % motivationalAyahs.length;
            const ayah = motivationalAyahs[currentAyahIndex];
            
            document.getElementById('ayah-arabic').textContent = ayah.arabic;
            document.getElementById('ayah-translation').textContent = `"${ayah.translation}"`;
            document.getElementById('ayah-reference').textContent = ayah.reference;
        }

        function updateLessonsDisplay() {
            const lessonsScreen = document.getElementById('lesson-selection');
            if (lessonsScreen && !lessonsScreen.classList.contains('hidden')) {
                generateLessonsGrid();
            }
        }

        function updateOverallProgress() {
            const completed = userProgress.completedLessons.size + userProgress.passedExams.size;
            const total = 100;
            const percentage = (completed / total) * 100;
            
            document.getElementById('overall-progress').textContent = `${completed}/${total}`;
            document.getElementById('overall-progress-bar').style.width = `${percentage}%`;
        }

        function updateHomeProgress() {
            const completed = userProgress.completedLessons.size + userProgress.passedExams.size;
            document.getElementById('home-progress').textContent = `${completed}/100`;
            
            const learnedWords = getLearnedWordsCount();
            document.getElementById('words-learned').textContent = learnedWords;
        }

        function getLearnedWordsCount() {
            let count = 0;
            userProgress.completedLessons.forEach(lessonId => {
                if (lessonId % 10 !== 0) {
                    const lessonWords = vocabularyData[lessonId] || generateExtendedVocabulary(lessonId);
                    count += lessonWords.length;
                }
            });
            return count;
        }

        // Initialize app
        function initializeApp() {
            loadProgress();
            updateOverallProgress();
            updateHomeProgress();
            generateLessonsGrid();
            changeAyah();
        }

        // Initialize app when page loads
        initializeApp();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99ef75d6d27a371d',t:'MTc2MzIxNzE3MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
