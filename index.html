<!doctype html>
<html lang="ru" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê—Ä–∞–±—Å–∫–∏–π –¥–ª—è –ö–æ—Ä–∞–Ω–∞</title><!-- PWA Meta Tags –¥–ª—è iPhone -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="–ê—Ä–∞–±—Å–∫–∏–π"><!-- –ò–∫–æ–Ω–∫–∞ –¥–ª—è iPhone (180x180) -->
  <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2300ff88'/%3E%3Cstop offset='100%25' style='stop-color:%2300ccff'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='180' height='180' fill='url(%23bg)' rx='40'/%3E%3Ctext x='90' y='75' font-family='serif' font-size='48' fill='white' text-anchor='middle' font-weight='bold'%3Eÿπ%3C/text%3E%3Ctext x='90' y='125' font-family='sans-serif' font-size='24' fill='white' text-anchor='middle'%3EŸÇÿ±ÿ¢ŸÜ%3C/text%3E%3C/svg%3E"><!-- –û–±—ã—á–Ω–∞—è –∏–∫–æ–Ω–∫–∞ -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='bg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%2300ff88'/><stop offset='100%25' style='stop-color:%2300ccff'/></linearGradient></defs><rect width='100' height='100' fill='url(%23bg)' rx='20'/><text x='50' y='35' font-family='serif' font-size='24' fill='white' text-anchor='middle' font-weight='bold'>ÿπ</text><text x='50' y='65' font-family='sans-serif' font-size='12' fill='white' text-anchor='middle'>ŸÇÿ±ÿ¢ŸÜ</text></svg>" type="image/svg+xml">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        .arabic-text {
            font-family: 'Amiri', 'Traditional Arabic', serif;
            font-size: 2.5rem;
            direction: rtl;
            text-align: right;
        }
        
        .progress-bar {
            transition: width 0.2s ease;
            background: linear-gradient(90deg, #00ff88, #00ccff);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }
        
        .task-card {
            transition: all 0.2s ease;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 1px solid #00ff88;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.1);
        }
        
        .correct-answer {
            background: linear-gradient(135deg, #00ff88, #00cc66) !important;
            color: #000 !important;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.6);
            font-weight: bold;
        }
        
        .incorrect-answer {
            background: linear-gradient(135deg, #ff0066, #cc0044) !important;
            color: white !important;
            box-shadow: 0 0 15px rgba(255, 0, 102, 0.6);
        }
        
        .option-button {
            transition: all 0.15s ease;
            background: linear-gradient(135deg, #2a2a4a, #1e1e3f);
            border: 1px solid #444;
            color: #fff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            font-size: 1.1rem;
            padding: 1rem;
        }
        
        @media (hover: hover) {
            .option-button:hover:not(:disabled) {
                transform: translateY(-2px);
                box-shadow: 0 4px 15px rgba(0, 255, 136, 0.3);
                border-color: #00ff88;
                background: linear-gradient(135deg, #3a3a5a, #2e2e4f);
            }
        }
        
        .word-tile {
            background: linear-gradient(135deg, #2a2a4a, #1e1e3f);
            border: 1px solid #444;
            border-radius: 8px;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.15s ease;
            user-select: none;
        }
        
        @media (hover: hover) {
            .word-tile:hover {
                border-color: #00ff88;
                transform: translateY(-2px);
                box-shadow: 0 4px 10px rgba(0, 255, 136, 0.3);
            }
        }
        
        .word-tile.selected {
            background: linear-gradient(135deg, #00ff88, #00cc66);
            color: #000;
            border-color: #00ff88;
            font-weight: bold;
        }
        
        .word-tile.disabled {
            opacity: 0.3;
            pointer-events: none;
        }
        
        .answer-slot {
            min-height: 60px;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 2px dashed #444;
            border-radius: 8px;
            padding: 10px;
            min-width: 200px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            justify-content: center;
        }
        
        .answer-slot.correct {
            border-color: #00ff88;
            background: linear-gradient(135deg, #1a4a2a, #1e3f1e);
        }
        
        .answer-slot.incorrect {
            border-color: #ff0066;
            background: linear-gradient(135deg, #4a1a2a, #3f1e1e);
        }
        
        .lesson-card {
            background: linear-gradient(135deg, #2a2a4a, #1e1e3f);
            border: 1px solid #444;
            transition: all 0.15s ease;
        }
        
        @media (hover: hover) {
            .lesson-card:hover {
                border-color: #00ff88;
                box-shadow: 0 4px 15px rgba(0, 255, 136, 0.2);
                transform: translateY(-2px);
            }
        }
        
        .lesson-card.completed {
            border-color: #00ff88;
            background: linear-gradient(135deg, #1a4a2a, #1e3f1e);
        }
        
        .neon-text {
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.8);
        }
        
        .neon-border {
            border: 1px solid #00ff88;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .dictionary-card {
            perspective: 1000px;
            height: 120px;
            cursor: pointer;
        }
        
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .dictionary-card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 16px;
        }
        
        .card-front {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 1px solid #00ff88;
        }
        
        .card-back {
            background: linear-gradient(135deg, #2a2a4a, #1e1e3f);
            border: 1px solid #00ccff;
            transform: rotateY(180deg);
        }
        
        .glow-button {
            background: linear-gradient(135deg, #00ff88, #00cc66);
            color: #000;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.4);
            transition: all 0.15s ease;
        }
        
        @media (hover: hover) {
            .glow-button:hover {
                box-shadow: 0 0 25px rgba(0, 255, 136, 0.6);
                transform: translateY(-1px);
            }
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #00ff88, #00cc66);
            color: #000;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.4);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .github-info {
            background: linear-gradient(135deg, #2a2a4a, #1e1e3f);
            border: 1px solid #444;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-gradient-to-br from-gray-900 via-purple-900 to-black font-sans">
  <div class="min-h-full flex flex-col"><!-- Header -->
   <header class="bg-gradient-to-r from-gray-800 to-gray-900 shadow-lg border-b border-green-400 neon-border">
    <div class="max-w-6xl mx-auto px-4 py-4">
     <div class="flex items-center justify-center">
      <div class="text-center">
       <div class="text-sm text-green-300 mb-1">
        <span id="overall-progress">0/5</span>
       </div>
       <div class="w-48 bg-gray-700 rounded-full h-3 border border-gray-600">
        <div id="overall-progress-bar" class="progress-bar h-3 rounded-full" style="width: 0%"></div>
       </div>
      </div>
     </div>
    </div>
   </header><!-- Main Content -->
   <main class="flex-1 p-4"><!-- Home Screen -->
    <div id="home-screen" class="max-w-4xl mx-auto text-center"><!-- GitHub Info -->
     <div class="github-info text-left mb-8">
      <h3 class="text-lg font-bold text-cyan-300 mb-2">üì± –î–æ–±–∞–≤—å—Ç–µ –Ω–∞ –¥–æ–º–∞—à–Ω–∏–π —ç–∫—Ä–∞–Ω</h3>
      <p class="text-gray-300 text-sm mb-2"><strong>iPhone:</strong> –û—Ç–∫—Ä–æ–π—Ç–µ –≤ Safari ‚Üí –ù–∞–∂–º–∏—Ç–µ <span class="inline-block">‚éô</span> ‚Üí "–ù–∞ —ç–∫—Ä–∞–Ω ¬´–î–æ–º–æ–π¬ª"</p>
      <p class="text-gray-400 text-xs">–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</p>
     </div>
     <div class="mb-12">
      <h1 class="text-4xl font-bold text-white neon-text mb-4" id="main-title">–ê—Ä–∞–±—Å–∫–∏–π –¥–ª—è –ö–æ—Ä–∞–Ω–∞</h1>
      <p class="text-green-300 text-lg mb-8">–ò–∑—É—á–∞–π—Ç–µ —Å–≤—è—â–µ–Ω–Ω—ã–π —è–∑—ã–∫ –ö–æ—Ä–∞–Ω–∞ –ø–æ—à–∞–≥–æ–≤–æ</p><!-- Main Menu Buttons -->
      <div class="grid grid-cols-1 gap-4"><button class="bg-gradient-to-br from-purple-600 to-purple-800 text-white rounded-xl p-6 text-left transition-all hover:from-purple-500 hover:to-purple-700" onclick="showLessons()">
        <div class="text-3xl mb-3">
         üìö
        </div><h3 class="text-lg font-bold mb-2">–£—Ä–æ–∫–∏</h3><p class="text-sm text-purple-200">5 —É—Ä–æ–∫–æ–≤ –∫–æ—Ä–∞–Ω–∏—á–µ—Å–∫–æ–π –ª–µ–∫—Å–∏–∫–∏</p>
        <div class="mt-3 text-sm text-purple-300">
         –ü—Ä–æ–≥—Ä–µ—Å—Å: <span id="home-progress">0/5</span>
        </div></button> <button class="bg-gradient-to-br from-cyan-600 to-cyan-800 text-white rounded-xl p-6 text-left transition-all hover:from-cyan-500 hover:to-cyan-700" onclick="showPractice()">
        <div class="text-3xl mb-3">
         üéÆ
        </div><h3 class="text-lg font-bold mb-2">–ü—Ä–∞–∫—Ç–∏–∫–∞</h3><p class="text-sm text-cyan-200">–°–æ–±–∏—Ä–∞–π—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –∞—Ä–∞–±—Å–∫–æ–º</p>
        <div class="mt-3 text-sm text-cyan-300">
         7 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏
        </div></button> <button class="bg-gradient-to-br from-purple-600 to-purple-800 text-white rounded-xl p-6 text-left transition-all hover:from-purple-500 hover:to-purple-700" onclick="showDictionary()">
        <div class="text-3xl mb-3">
         üìñ
        </div><h3 class="text-lg font-bold mb-2">–°–ª–æ–≤–∞—Ä—å</h3><p class="text-sm text-purple-200">–í—Å–µ –∏–∑—É—á–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞ —Å –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏</p>
        <div class="mt-3 text-sm text-purple-300">
         –°–ª–æ–≤ –∏–∑—É—á–µ–Ω–æ: <span id="words-learned">0</span>
        </div></button> <!-- Data Management -->
       <div class="bg-gradient-to-br from-gray-600 to-gray-800 text-white rounded-xl p-6 text-left">
        <div class="text-3xl mb-3">
         üíæ
        </div>
        <h3 class="text-lg font-bold mb-2">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</h3>
        <p class="text-sm text-gray-200 mb-4">–≠–∫—Å–ø–æ—Ä—Ç –∏ –∏–º–ø–æ—Ä—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</p>
        <div class="flex gap-2 flex-wrap"><button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm transition-colors" onclick="exportProgress()"> –≠–∫—Å–ø–æ—Ä—Ç </button> <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm transition-colors" onclick="importProgress()"> –ò–º–ø–æ—Ä—Ç </button>
        </div>
       </div>
      </div>
     </div>
    </div><!-- Lesson Selection Screen -->
    <div id="lesson-selection" class="hidden max-w-6xl mx-auto">
     <div class="flex items-center justify-between mb-6"><button class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2" onclick="showHome()"> ‚Üê –ì–ª–∞–≤–Ω–∞—è </button>
      <h2 class="text-2xl font-bold text-white neon-text">–£—Ä–æ–∫–∏</h2>
      <div></div>
     </div>
     <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-4xl mx-auto">
      <div id="lesson-1" class="lesson-card rounded-lg p-6 cursor-pointer" onclick="startLesson(1)">
       <div class="text-center">
        <div class="text-3xl mb-3">
         üìñ
        </div>
        <h3 class="font-bold text-white mb-2">–£—Ä–æ–∫ 1</h3>
        <p class="text-sm text-gray-300">–ë–∞–∑–æ–≤–∞—è –ª–µ–∫—Å–∏–∫–∞</p>
        <p class="text-xs text-gray-400 mt-2">12 —Å–ª–æ–≤</p>
       </div>
      </div>
      <div id="lesson-2" class="lesson-card rounded-lg p-6 cursor-pointer" onclick="startLesson(2)">
       <div class="text-center">
        <div class="text-3xl mb-3">
         üåç
        </div>
        <h3 class="font-bold text-white mb-2">–£—Ä–æ–∫ 2</h3>
        <p class="text-sm text-gray-300">–ü—Ä–∏—Ä–æ–¥–∞</p>
        <p class="text-xs text-gray-400 mt-2">12 —Å–ª–æ–≤</p>
       </div>
      </div>
      <div id="lesson-3" class="lesson-card rounded-lg p-6 cursor-pointer" onclick="startLesson(3)">
       <div class="text-center">
        <div class="text-3xl mb-3">
         üïå
        </div>
        <h3 class="font-bold text-white mb-2">–£—Ä–æ–∫ 3</h3>
        <p class="text-sm text-gray-300">–†–µ–ª–∏–≥–∏–æ–∑–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã</p>
        <p class="text-xs text-gray-400 mt-2">12 —Å–ª–æ–≤</p>
       </div>
      </div>
      <div id="lesson-4" class="lesson-card rounded-lg p-6 cursor-pointer" onclick="startLesson(4)">
       <div class="text-center">
        <div class="text-3xl mb-3">
         üë§
        </div>
        <h3 class="font-bold text-white mb-2">–£—Ä–æ–∫ 4</h3>
        <p class="text-sm text-gray-300">–ß–∞—Å—Ç–∏ —Ç–µ–ª–∞ –∏ –≥–ª–∞–≥–æ–ª—ã</p>
        <p class="text-xs text-gray-400 mt-2">12 —Å–ª–æ–≤</p>
       </div>
      </div>
      <div id="lesson-5" class="lesson-card rounded-lg p-6 cursor-pointer" onclick="startLesson(5)">
       <div class="text-center">
        <div class="text-3xl mb-3">
         ‚≠ê
        </div>
        <h3 class="font-bold text-white mb-2">–£—Ä–æ–∫ 5</h3>
        <p class="text-sm text-gray-300">–ü–æ–Ω—è—Ç–∏—è –≤–µ—Ä—ã</p>
        <p class="text-xs text-gray-400 mt-2">12 —Å–ª–æ–≤</p>
       </div>
      </div>
     </div>
    </div><!-- Practice Screen -->
    <div id="practice-screen" class="hidden max-w-4xl mx-auto">
     <div class="flex items-center justify-between mb-6"><button class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2" onclick="showHome()"> ‚Üê –ì–ª–∞–≤–Ω–∞—è </button>
      <h2 class="text-2xl font-bold text-white neon-text">–ü—Ä–∞–∫—Ç–∏–∫–∞</h2>
      <div class="text-sm text-green-300"><span id="practice-progress">0/7</span>
      </div>
     </div>
     <div id="practice-task" class="task-card rounded-xl shadow-lg p-8"><!-- Practice task will be rendered here -->
     </div>
    </div><!-- Dictionary Screen -->
    <div id="dictionary-screen" class="hidden max-w-4xl mx-auto">
     <div class="flex items-center justify-between mb-6"><button class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2" onclick="showHome()"> ‚Üê –ì–ª–∞–≤–Ω–∞—è </button>
      <h2 class="text-2xl font-bold text-white neon-text">–°–ª–æ–≤–∞—Ä—å</h2>
      <div class="text-sm text-green-300"><span id="dict-word-count">0</span> —Å–ª–æ–≤
      </div>
     </div><!-- Search and Filter -->
     <div class="bg-gradient-to-r from-gray-800 to-gray-700 border border-green-400 rounded-lg p-4 mb-6">
      <div class="flex flex-col md:flex-row gap-4"><input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∞—Ä–∞–±—Å–∫–æ–º—É —Ç–µ–∫—Å—Ç—É –∏–ª–∏ –ø–µ—Ä–µ–≤–æ–¥—É..." class="flex-1 bg-gray-900 border border-gray-600 rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:border-green-400 focus:outline-none"> <select id="type-filter" class="bg-gray-900 border border-gray-600 rounded-lg px-4 py-2 text-white focus:border-green-400 focus:outline-none"> <option value="">–í—Å–µ —Ç–∏–ø—ã</option> <option value="noun">–°—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ</option> <option value="verb">–ì–ª–∞–≥–æ–ª—ã</option> <option value="preposition">–ü—Ä–µ–¥–ª–æ–≥–∏</option> <option value="pronoun">–ú–µ—Å—Ç–æ–∏–º–µ–Ω–∏—è</option> <option value="particle">–ß–∞—Å—Ç–∏—Ü—ã</option> <option value="interrogative">–í–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ</option> </select>
      </div>
     </div><!-- Dictionary Content -->
     <div id="dictionary-content" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"><!-- Dictionary words will be generated here -->
     </div>
    </div><!-- Lesson Screen -->
    <div id="lesson-screen" class="hidden max-w-2xl mx-auto"><!-- Back Button -->
     <div class="flex items-center justify-between mb-6"><button class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2" onclick="backToLessons()"> ‚Üê –ö —É—Ä–æ–∫–∞–º </button>
      <div class="text-white text-sm"><span id="lesson-title-header">–£—Ä–æ–∫ 1</span>
      </div>
      <div></div>
     </div><!-- Task Container -->
     <div id="task-container" class="task-card bg-white rounded-xl shadow-lg p-8 fade-in"><!-- Task content will be inserted here -->
     </div><!-- Lesson Results -->
     <div id="results-container" class="hidden">
      <div class="task-card rounded-xl shadow-lg p-8 text-center">
       <div class="text-6xl mb-4">
        üéâ
       </div>
       <h2 id="results-title" class="text-2xl font-bold text-white neon-text mb-4">–£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à—ë–Ω!</h2>
       <div id="results-stats" class="text-green-300 mb-6">
        <p>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: <span id="correct-answers" class="font-semibold text-white">0</span> –∏–∑ <span id="total-tasks" class="font-semibold text-white">24</span></p>
       </div>
       <div class="bg-gray-800 border border-cyan-400 rounded-lg p-4 mb-6">
        <h3 class="font-semibold text-cyan-300 mb-2">–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!</h3>
        <div class="text-sm text-gray-300">
         –í—ã –∏–∑—É—á–∏–ª–∏ 12 –Ω–æ–≤—ã—Ö —Å–ª–æ–≤
        </div>
       </div><button id="back-to-lessons" class="glow-button px-8 py-3 rounded-lg font-semibold transition-all" onclick="backToLessons()"> –ö —É—Ä–æ–∫–∞–º </button>
      </div>
     </div>
    </div>
   </main><!-- Hidden file input for import --> <input type="file" id="import-file" accept=".json" style="display: none;" onchange="handleFileImport(event)">
  </div>
  <script>
        // Vocabulary data - –≤—Å–µ 5 —É—Ä–æ–∫–æ–≤
        const vocabularyData = {
            1: [
                {arabic: "ŸÉŸêÿ™Ÿéÿßÿ®Ÿå", translation: "–∫–Ω–∏–≥–∞", type: "noun", root: "ŸÉ-ÿ™-ÿ®"},
                {arabic: "ÿ®ŸéŸäŸíÿ™Ÿå", translation: "–¥–æ–º", type: "noun", root: "ÿ®-Ÿä-ÿ™"},
                {arabic: "ŸÖŸéÿØŸíÿ±Ÿéÿ≥Ÿéÿ©Ÿå", translation: "—à–∫–æ–ª–∞", type: "noun", root: "ÿØ-ÿ±-ÿ≥"},
                {arabic: "ÿµŸéÿØŸêŸäŸÇŸå", translation: "–¥—Ä—É–≥", type: "noun", root: "ÿµ-ÿØ-ŸÇ"},
                {arabic: "ÿ∑ŸéÿπŸéÿßŸÖŸå", translation: "–µ–¥–∞", type: "noun", root: "ÿ∑-ÿπ-ŸÖ"},
                {arabic: "ÿ£ŸéŸÜŸéÿß", translation: "—è", type: "pronoun", root: "ÿß-ŸÜ-ÿß"},
                {arabic: "ŸáŸèŸàŸé", translation: "–æ–Ω", type: "pronoun", root: "Ÿá-Ÿà"},
                {arabic: "ŸáŸêŸäŸé", translation: "–æ–Ω–∞", type: "pronoun", root: "Ÿá-Ÿä"},
                {arabic: "ŸÅŸêŸä", translation: "–≤", type: "preposition", root: "ŸÅ-Ÿä"},
                {arabic: "ŸÖŸéÿπŸé", translation: "—Å", type: "preposition", root: "ŸÖ-ÿπ"},
                {arabic: "ÿßŸÑŸíŸäŸéŸàŸíŸÖŸé", translation: "—Å–µ–≥–æ–¥–Ω—è", type: "noun", root: "Ÿä-Ÿà-ŸÖ"},
                {arabic: "ÿ£ŸéŸÉŸéŸÑŸíÿ™Ÿè", translation: "—è –µ–ª", type: "verb", root: "ÿß-ŸÉ-ŸÑ"}
            ],
            2: [
                {arabic: "ŸÖŸéÿßÿ°Ÿå", translation: "–≤–æ–¥–∞", type: "noun", root: "ŸÖ-Ÿà-ÿ°"},
                {arabic: "ÿ≥ŸéŸÖŸéÿßÿ°Ÿå", translation: "–Ω–µ–±–æ", type: "noun", root: "ÿ≥-ŸÖ-Ÿà"},
                {arabic: "ÿ£Ÿéÿ±Ÿíÿ∂Ÿå", translation: "–∑–µ–º–ª—è", type: "noun", root: "ÿß-ÿ±-ÿ∂"},
                {arabic: "ÿ¥ŸéŸÖŸíÿ≥Ÿå", translation: "—Å–æ–ª–Ω—Ü–µ", type: "noun", root: "ÿ¥-ŸÖ-ÿ≥"},
                {arabic: "ŸÇŸéŸÖŸéÿ±Ÿå", translation: "–ª—É–Ω–∞", type: "noun", root: "ŸÇ-ŸÖ-ÿ±"},
                {arabic: "ŸÜŸéŸáŸéÿßÿ±Ÿå", translation: "–¥–µ–Ω—å", type: "noun", root: "ŸÜ-Ÿá-ÿ±"},
                {arabic: "ŸÑŸéŸäŸíŸÑŸå", translation: "–Ω–æ—á—å", type: "noun", root: "ŸÑ-Ÿä-ŸÑ"},
                {arabic: "ŸÜŸéÿ¨ŸíŸÖŸå", translation: "–∑–≤–µ–∑–¥–∞", type: "noun", root: "ŸÜ-ÿ¨-ŸÖ"},
                {arabic: "ÿ±ŸêŸäÿ≠Ÿå", translation: "–≤–µ—Ç–µ—Ä", type: "noun", root: "ÿ±-Ÿà-ÿ≠"},
                {arabic: "ÿ¥Ÿéÿ¨Ÿéÿ±Ÿéÿ©Ÿå", translation: "–¥–µ—Ä–µ–≤–æ", type: "noun", root: "ÿ¥-ÿ¨-ÿ±"},
                {arabic: "ÿ¨Ÿéÿ®ŸéŸÑŸå", translation: "–≥–æ—Ä–∞", type: "noun", root: "ÿ¨-ÿ®-ŸÑ"},
                {arabic: "ÿ®Ÿéÿ≠Ÿíÿ±Ÿå", translation: "–º–æ—Ä–µ", type: "noun", root: "ÿ®-ÿ≠-ÿ±"}
            ],
            3: [
                {arabic: "ÿßŸÑŸÑŸáŸè", translation: "–ê–ª–ª–∞—Ö", type: "noun", root: "ÿß-ŸÑ-Ÿá"},
                {arabic: "ŸÜŸéÿ®ŸêŸäŸåŸë", translation: "–ø—Ä–æ—Ä–æ–∫", type: "noun", root: "ŸÜ-ÿ®-ÿß"},
                {arabic: "ÿµŸéŸÑÿßŸéÿ©Ÿå", translation: "–º–æ–ª–∏—Ç–≤–∞", type: "noun", root: "ÿµ-ŸÑ-Ÿà"},
                {arabic: "ŸÇŸèÿ±Ÿíÿ¢ŸÜŸå", translation: "–ö–æ—Ä–∞–Ω", type: "noun", root: "ŸÇ-ÿ±-ÿß"},
                {arabic: "ÿ•ŸêŸäŸÖŸéÿßŸÜŸå", translation: "–≤–µ—Ä–∞", type: "noun", root: "ÿß-ŸÖ-ŸÜ"},
                {arabic: "ÿ±Ÿéÿ≥ŸèŸàŸÑŸå", translation: "–ø–æ—Å–ª–∞–Ω–Ω–∏–∫", type: "noun", root: "ÿ±-ÿ≥-ŸÑ"},
                {arabic: "ŸÖŸéŸÑŸéŸÉŸå", translation: "–∞–Ω–≥–µ–ª", type: "noun", root: "ŸÖ-ŸÑ-ŸÉ"},
                {arabic: "ŸÉŸéÿßŸÅŸêÿ±Ÿå", translation: "–Ω–µ–≤–µ—Ä—É—é—â–∏–π", type: "noun", root: "ŸÉ-ŸÅ-ÿ±"},
                {arabic: "ŸÖŸèÿ§ŸíŸÖŸêŸÜŸå", translation: "–≤–µ—Ä—É—é—â–∏–π", type: "noun", root: "ÿß-ŸÖ-ŸÜ"},
                {arabic: "ÿπŸêÿ®ŸéÿßÿØŸéÿ©Ÿå", translation: "–ø–æ–∫–ª–æ–Ω–µ–Ω–∏–µ", type: "noun", root: "ÿπ-–±-–¥"},
                {arabic: "ÿ±Ÿéÿ≠ŸíŸÖŸéÿ©Ÿå", translation: "–º–∏–ª–æ—Å—Ç—å", type: "noun", root: "ÿ±-ÿ≠-ŸÖ"},
                {arabic: "ÿπŸéÿ∞Ÿéÿßÿ®Ÿå", translation: "–Ω–∞–∫–∞–∑–∞–Ω–∏–µ", type: "noun", root: "ÿπ-ÿ∞-ÿ®"}
            ],
            4: [
                {arabic: "ŸÇŸéŸÑŸíÿ®Ÿå", translation: "—Å–µ—Ä–¥—Ü–µ", type: "noun", root: "ŸÇ-ŸÑ-ÿ®"},
                {arabic: "ÿπŸéŸäŸíŸÜŸå", translation: "–≥–ª–∞–∑", type: "noun", root: "ÿπ-Ÿä-ŸÜ"},
                {arabic: "ŸäŸéÿØŸå", translation: "—Ä—É–∫–∞", type: "noun", root: "Ÿä-ÿØ"},
                {arabic: "ŸàŸéÿ¨ŸíŸáŸå", translation: "–ª–∏—Ü–æ", type: "noun", root: "Ÿà-ÿ¨-Ÿá"},
                {arabic: "ŸÜŸéŸÅŸíÿ≥Ÿå", translation: "–¥—É—à–∞", type: "noun", root: "ŸÜ-ŸÅ-ÿ≥"},
                {arabic: "ŸÇŸéÿßŸÑŸé", translation: "–æ–Ω —Å–∫–∞–∑–∞–ª", type: "verb", root: "ŸÇ-Ÿà-ŸÑ"},
                {arabic: "ŸÅŸéÿπŸéŸÑŸé", translation: "–æ–Ω —Å–¥–µ–ª–∞–ª", type: "verb", root: "ŸÅ-ÿπ-ŸÑ"},
                {arabic: "ÿ¨Ÿéÿßÿ°Ÿé", translation: "–æ–Ω –ø—Ä–∏—à–µ–ª", type: "verb", root: "ÿ¨-Ÿä-ÿ°"},
                {arabic: "ÿ∞ŸéŸáŸéÿ®Ÿé", translation: "–æ–Ω —É—à–µ–ª", type: "verb", root: "ÿ∞-Ÿá-ÿ®"},
                {arabic: "ÿπŸéŸÑŸêŸÖŸé", translation: "–æ–Ω –∑–Ω–∞–ª", type: "verb", root: "ÿπ-ŸÑ-ŸÖ"},
                {arabic: "ŸÉŸéÿ™Ÿéÿ®Ÿé", translation: "–æ–Ω –ø–∏—Å–∞–ª", type: "verb", root: "ŸÉ-ÿ™-ÿ®"},
                {arabic: "ŸÇŸéÿ±Ÿéÿ£Ÿé", translation: "–æ–Ω —á–∏—Ç–∞–ª", type: "verb", root: "ŸÇ-ÿ±-ÿß"}
            ],
            5: [
                {arabic: "ÿ≠ŸéŸÇŸåŸë", translation: "–∏—Å—Ç–∏–Ω–∞", type: "noun", root: "ÿ≠-ŸÇ-ŸÇ"},
                {arabic: "ÿ®Ÿéÿßÿ∑ŸêŸÑŸå", translation: "–ª–æ–∂—å", type: "noun", root: "ÿ®-ÿ∑-ŸÑ"},
                {arabic: "ÿÆŸéŸäŸíÿ±Ÿå", translation: "–¥–æ–±—Ä–æ", type: "noun", root: "ÿÆ-Ÿä-ÿ±"},
                {arabic: "ÿ¥Ÿéÿ±ŸåŸë", translation: "–∑–ª–æ", type: "noun", root: "ÿ¥-ÿ±-ÿ±"},
                {arabic: "ÿ¨ŸéŸÜŸéŸëÿ©Ÿå", translation: "—Ä–∞–π", type: "noun", root: "ÿ¨-ŸÜ-ŸÜ"},
                {arabic: "ŸÜŸéÿßÿ±Ÿå", translation: "–æ–≥–æ–Ω—å/–∞–¥", type: "noun", root: "ŸÜ-Ÿà-ÿ±"},
                {arabic: "ÿ™ŸéŸàŸíÿ®Ÿéÿ©Ÿå", translation: "–ø–æ–∫–∞—è–Ω–∏–µ", type: "noun", root: "ÿ™-Ÿà-ÿ®"},
                {arabic: "ÿµŸéÿ®Ÿíÿ±Ÿå", translation: "—Ç–µ—Ä–ø–µ–Ω–∏–µ", type: "noun", root: "ÿµ-ÿ®-ÿ±"},
                {arabic: "ÿ¥ŸèŸÉŸíÿ±Ÿå", translation: "–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å", type: "noun", root: "ÿ¥-ŸÉ-ÿ±"},
                {arabic: "ÿ∞ŸêŸÉŸíÿ±Ÿå", translation: "–ø–æ–º–∏–Ω–∞–Ω–∏–µ", type: "noun", root: "ÿ∞-ŸÉ-ÿ±"},
                {arabic: "ŸÜŸèŸàÿ±Ÿå", translation: "—Å–≤–µ—Ç", type: "noun", root: "ŸÜ-Ÿà-ÿ±"},
                {arabic: "ŸáŸèÿØŸãŸâ", translation: "—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ", type: "noun", root: "Ÿá-ÿØ-Ÿä"}
            ]
        };

        // Practice sentences data
        const practiceSentences = [
            {
                russian: "–ú–µ–Ω—è –∑–æ–≤—É—Ç –®–∞–º–∏–ª—å, —è –ø—Ä–∏–µ—Ö–∞–ª –∏–∑ –î–∞–≥–µ—Å—Ç–∞–Ω–∞",
                arabic: ["ÿßŸêÿ≥ŸíŸÖŸêŸä", "ÿ¥ŸéÿßŸÖŸêŸÑŸå", "ÿ¨Ÿêÿ¶Ÿíÿ™Ÿè", "ŸÖŸêŸÜŸí", "ÿØŸéÿßÿ∫Ÿêÿ≥Ÿíÿ™ŸéÿßŸÜŸé"],
                correctOrder: ["ÿßŸêÿ≥ŸíŸÖŸêŸä", "ÿ¥ŸéÿßŸÖŸêŸÑŸå", "ÿ¨Ÿêÿ¶Ÿíÿ™Ÿè", "ŸÖŸêŸÜŸí", "ÿØŸéÿßÿ∫Ÿêÿ≥Ÿíÿ™ŸéÿßŸÜŸé"]
            },
            {
                russian: "–ì–¥–µ —è –º–æ–≥—É –ø–æ–æ–±–µ–¥–∞—Ç—å –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏?",
                arabic: ["ÿ£ŸéŸäŸíŸÜŸé", "ŸäŸèŸÖŸíŸÉŸêŸÜŸèŸÜŸêŸä", "ÿ™ŸéŸÜŸéÿßŸàŸèŸÑŸè", "ÿßŸÑÿ∫ŸéÿØŸéÿßÿ°Ÿê", "ŸÇŸéÿ±ŸêŸäÿ®Ÿãÿß", "ŸÖŸêŸÜŸí", "ŸáŸèŸÜŸéÿß"],
                correctOrder: ["ÿ£ŸéŸäŸíŸÜŸé", "ŸäŸèŸÖŸíŸÉŸêŸÜŸèŸÜŸêŸä", "ÿ™ŸéŸÜŸéÿßŸàŸèŸÑŸè", "ÿßŸÑÿ∫ŸéÿØŸéÿßÿ°Ÿê", "ŸÇŸéÿ±ŸêŸäÿ®Ÿãÿß", "ŸÖŸêŸÜŸí", "ŸáŸèŸÜŸéÿß"]
            },
            {
                russian: "–Ø –ø–æ—Ç–µ—Ä—è–ª—Å—è, –Ω–µ –º–æ–≥–ª–∏ –±—ã –≤—ã –º–Ω–µ –ø–æ–º–æ—á—å?",
                arabic: ["ÿ£ŸéŸÜŸéÿß", "ÿ∂Ÿéÿßÿ¶ŸêÿπŸå", "ŸáŸéŸÑŸí", "ŸäŸèŸÖŸíŸÉŸêŸÜŸèŸÉŸèŸÖ", "ŸÖŸèÿ≥ŸéÿßÿπŸéÿØŸéÿ™ŸêŸä"],
                correctOrder: ["ÿ£ŸéŸÜŸéÿß", "ÿ∂Ÿéÿßÿ¶ŸêÿπŸå", "ŸáŸéŸÑŸí", "ŸäŸèŸÖŸíŸÉŸêŸÜŸèŸÉŸèŸÖ", "ŸÖŸèÿ≥ŸéÿßÿπŸéÿØŸéÿ™ŸêŸä"]
            },
            {
                russian: "–ú—ã —Å –º–æ–∏–º –±—Ä–∞—Ç–æ–º –ª—é–±–∏–º –∫—É–ø–∞—Ç—å—Å—è –≤ —Ö–æ–ª–æ–¥–Ω–æ–π –≥–æ—Ä–Ω–æ–π —Ä–µ–∫–µ –∏ –ª–∞–∑–∏—Ç—å –ø–æ –≥–æ—Ä–∞–º",
                arabic: ["ÿ£ŸéŸÜŸéÿß", "ŸàŸéÿ£ŸéÿÆŸêŸä", "ŸÜŸèÿ≠Ÿêÿ®ŸèŸë", "ÿßŸÑÿ≥ŸêŸëÿ®Ÿéÿßÿ≠Ÿéÿ©Ÿé", "ŸÅŸêŸä", "ÿßŸÑŸÜŸéŸëŸáŸíÿ±Ÿê", "ÿßŸÑÿ®Ÿéÿßÿ±ŸêÿØŸê", "ŸÅŸêŸä", "ÿßŸÑÿ¨Ÿêÿ®ŸéÿßŸÑŸê", "ŸàŸéÿßŸÑÿ™ŸéŸëÿ¨ŸéŸàŸèŸëŸÑŸé", "ŸÅŸêŸäŸáŸéÿß"],
                correctOrder: ["ÿ£ŸéŸÜŸéÿß", "ŸàŸéÿ£ŸéÿÆŸêŸä", "ŸÜŸèÿ≠Ÿêÿ®ŸèŸë", "ÿßŸÑÿ≥ŸêŸëÿ®Ÿéÿßÿ≠Ÿéÿ©Ÿé", "ŸÅŸêŸä", "ÿßŸÑŸÜŸéŸëŸáŸíÿ±Ÿê", "ÿßŸÑÿ®Ÿéÿßÿ±ŸêÿØŸê", "ŸÅŸêŸä", "ÿßŸÑÿ¨Ÿêÿ®ŸéÿßŸÑŸê", "ŸàŸéÿßŸÑÿ™ŸéŸëÿ¨ŸéŸàŸèŸëŸÑŸé", "ŸÅŸêŸäŸáŸéÿß"]
            },
            {
                russian: "–í—á–µ—Ä–∞ —è –ø–∏–ª –∫–æ—Ñ–µ –∏ –∑–∞–±—ã–ª, –≥–¥–µ —è –µ–≥–æ –ø–æ–∫—É–ø–∞–ª",
                arabic: ["ÿ£ŸéŸÖŸíÿ≥Ÿê", "ÿ¥Ÿéÿ±Ÿêÿ®Ÿíÿ™Ÿè", "ÿßŸÑŸÇŸéŸáŸíŸàŸéÿ©Ÿé", "ŸàŸéŸÜŸéÿ≥ŸêŸäÿ™Ÿè", "ÿ£ŸéŸäŸíŸÜŸé", "ÿ¥Ÿéÿ±ŸéŸäŸíÿ™ŸèŸáŸéÿß"],
                correctOrder: ["ÿ£ŸéŸÖŸíÿ≥Ÿê", "ÿ¥Ÿéÿ±Ÿêÿ®Ÿíÿ™Ÿè", "ÿßŸÑŸÇŸéŸáŸíŸàŸéÿ©Ÿé", "ŸàŸéŸÜŸéÿ≥ŸêŸäÿ™Ÿè", "ÿ£ŸéŸäŸíŸÜŸé", "ÿ¥Ÿéÿ±ŸéŸäŸíÿ™ŸèŸáŸéÿß"]
            },
            {
                russian: "–Ø —É–µ–∑–∂–∞—é –∑–∞–≤—Ç—Ä–∞ –¥–æ–º–æ–π, —Å–ø–∞—Å–∏–±–æ –≤–∞–º –∑–∞ –≥–æ—Å—Ç–µ–ø—Ä–∏–∏–º—Å—Ç–≤–æ",
                arabic: ["ÿ£ŸéŸÜŸéÿß", "ÿ≥Ÿéÿ£Ÿèÿ≥ŸéÿßŸÅŸêÿ±Ÿè", "ÿ∫ŸéÿØŸãÿß", "ÿ•ŸêŸÑŸéŸâ", "ÿ®ŸéŸäŸíÿ™ŸêŸä", "ÿ¥ŸèŸÉŸíÿ±Ÿãÿß", "ÿπŸéŸÑŸéŸâ", "ÿ≠Ÿèÿ≥ŸíŸÜŸê", "ÿßŸÑÿßÿ≥Ÿíÿ™ŸêŸÇŸíÿ®ŸéÿßŸÑŸê"],
                correctOrder: ["ÿ£ŸéŸÜŸéÿß", "ÿ≥Ÿéÿ£Ÿèÿ≥ŸéÿßŸÅŸêÿ±Ÿè", "ÿ∫ŸéÿØŸãÿß", "ÿ•ŸêŸÑŸéŸâ", "ÿ®ŸéŸäŸíÿ™ŸêŸä", "ÿ¥ŸèŸÉŸíÿ±Ÿãÿß", "ÿπŸéŸÑŸéŸâ", "ÿ≠Ÿèÿ≥ŸíŸÜŸê", "ÿßŸÑÿßÿ≥Ÿíÿ™ŸêŸÇŸíÿ®ŸéÿßŸÑŸê"]
            },
            {
                russian: "–≠–π, —Ç—ã, –æ—Ç–¥–∞–π –º–æ—é —Å—É–º–∫—É, —è —Å–ø–æ—Ä—Ç—Å–º–µ–Ω, –∏–º–µ–π –≤ –≤–∏–¥—É",
                arabic: ["ŸáŸéŸäŸéŸëÿß", "ÿ£ŸéŸÜŸíÿ™Ÿé", "ÿ£ŸéÿπŸêÿØŸí", "ÿ≠ŸéŸÇŸêŸäÿ®Ÿéÿ™ŸêŸä", "ÿ£ŸéŸÜŸéÿß", "ÿ±ŸêŸäŸéÿßÿ∂ŸêŸäŸë", "ŸÅŸéÿ™Ÿéÿ∞ŸéŸÉŸéŸëÿ±Ÿí", "ÿ∞ŸéŸÑŸêŸÉŸé"],
                correctOrder: ["ŸáŸéŸäŸéŸëÿß", "ÿ£ŸéŸÜŸíÿ™Ÿé", "ÿ£ŸéÿπŸêÿØŸí", "ÿ≠ŸéŸÇŸêŸäÿ®Ÿéÿ™ŸêŸä", "ÿ£ŸéŸÜŸéÿß", "ÿ±ŸêŸäŸéÿßÿ∂ŸêŸäŸë", "ŸÅŸéÿ™Ÿéÿ∞ŸéŸÉŸéŸëÿ±Ÿí", "ÿ∞ŸéŸÑŸêŸÉŸé"]
            }
        ];

        // State
        let currentLesson = null;
        let currentTaskIndex = 0;
        let correctAnswers = 0;
        let userAnswers = [];
        let currentAnswer = null;
        let userProgress = {
            completedLessons: new Set(),
            currentLesson: 1
        };
        let learnedWordsPerLesson = new Map();
        let incorrectTasks = [];
        let isReviewMode = false;

        // Practice state
        let currentPracticeSentence = 0;
        let practiceCorrectAnswers = 0;
        let selectedWords = [];
        let availableWords = [];

        // Local Storage functions
        function saveProgress() {
            const progressData = {
                completedLessons: Array.from(userProgress.completedLessons),
                currentLesson: userProgress.currentLesson,
                learnedWords: Array.from(learnedWordsPerLesson.entries()).map(([key, value]) => [key, Array.from(value)]),
                timestamp: new Date().toISOString()
            };
            
            try {
                localStorage.setItem('arabic-quran-progress', JSON.stringify(progressData));
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞', 'error');
            }
        }

        function loadProgress() {
            try {
                const saved = localStorage.getItem('arabic-quran-progress');
                if (saved) {
                    const progressData = JSON.parse(saved);
                    userProgress.completedLessons = new Set(progressData.completedLessons || []);
                    userProgress.currentLesson = progressData.currentLesson || 1;
                    
                    learnedWordsPerLesson.clear();
                    if (progressData.learnedWords) {
                        progressData.learnedWords.forEach(([key, value]) => {
                            learnedWordsPerLesson.set(key, new Set(value));
                        });
                    }
                    
                    updateOverallProgress();
                    updateHomeProgress();
                    updateLessonCards();
                }
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞', 'error');
            }
        }

        function exportProgress() {
            const progressData = {
                completedLessons: Array.from(userProgress.completedLessons),
                currentLesson: userProgress.currentLesson,
                learnedWords: Array.from(learnedWordsPerLesson.entries()).map(([key, value]) => [key, Array.from(value)]),
                timestamp: new Date().toISOString(),
                version: "1.0"
            };
            
            const dataStr = JSON.stringify(progressData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `arabic-quran-progress-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showToast('–ü—Ä–æ–≥—Ä–µ—Å—Å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!');
        }

        function importProgress() {
            document.getElementById('import-file').click();
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const progressData = JSON.parse(e.target.result);
                    
                    if (progressData.version && progressData.completedLessons !== undefined) {
                        userProgress.completedLessons = new Set(progressData.completedLessons || []);
                        userProgress.currentLesson = progressData.currentLesson || 1;
                        
                        learnedWordsPerLesson.clear();
                        if (progressData.learnedWords) {
                            progressData.learnedWords.forEach(([key, value]) => {
                                learnedWordsPerLesson.set(key, new Set(value));
                            });
                        }
                        
                        saveProgress();
                        updateOverallProgress();
                        updateHomeProgress();
                        updateLessonCards();
                        
                        showToast('–ü—Ä–æ–≥—Ä–µ—Å—Å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!');
                    } else {
                        showToast('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞', 'error');
                    }
                } catch (error) {
                    showToast('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞', 'error');
                }
            };
            reader.readAsText(file);
            
            event.target.value = '';
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type === 'error' ? 'bg-red-600' : ''}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // Practice functions
        function showPractice() {
            currentPracticeSentence = 0;
            practiceCorrectAnswers = 0;
            
            document.getElementById('home-screen').classList.add('hidden');
            document.getElementById('practice-screen').classList.remove('hidden');
            
            renderPracticeTask();
        }

        function renderPracticeTask() {
            if (currentPracticeSentence >= practiceSentences.length) {
                showPracticeResults();
                return;
            }
            
            const sentence = practiceSentences[currentPracticeSentence];
            selectedWords = [];
            availableWords = [...sentence.arabic].sort(() => Math.random() - 0.5);
            
            document.getElementById('practice-progress').textContent = `${currentPracticeSentence + 1}/7`;
            
            const container = document.getElementById('practice-task');
            container.innerHTML = `
                <div class="text-center">
                    <div class="mb-6">
                        <h3 class="text-xl font-bold text-white mb-3">–°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:</h3>
                        <div class="bg-gradient-to-r from-gray-800 to-gray-700 border border-cyan-400 rounded-lg p-4 text-lg text-cyan-300">
                            ${sentence.russian}
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h4 class="text-sm text-gray-400 mb-2">–í–∞—à –æ—Ç–≤–µ—Ç:</h4>
                        <div id="answer-area" class="answer-slot justify-start">
                            <span class="text-gray-500">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–∞ –Ω–∏–∂–µ...</span>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h4 class="text-sm text-gray-400 mb-2">–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ–≤–∞:</h4>
                        <div id="words-area" class="flex flex-wrap gap-2 justify-center">
                            ${availableWords.map((word, index) => `
                                <div class="word-tile arabic-text text-xl text-white" onclick="selectWord(${index})" data-index="${index}">
                                    ${word}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="flex gap-3 justify-center">
                        <button id="check-btn" class="glow-button px-6 py-3 rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed" onclick="checkPracticeAnswer()" disabled>
                            –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                        </button>
                        <button class="bg-gray-700 hover:bg-gray-600 text-white px-6 py-3 rounded-lg transition-colors" onclick="clearPracticeAnswer()">
                            –û—á–∏—Å—Ç–∏—Ç—å
                        </button>
                    </div>
                </div>
            `;
        }

        function selectWord(index) {
            const word = availableWords[index];
            selectedWords.push(word);
            
            const wordTile = document.querySelector(`[data-index="${index}"]`);
            wordTile.classList.add('disabled');
            
            updateAnswerArea();
        }

        function updateAnswerArea() {
            const answerArea = document.getElementById('answer-area');
            
            if (selectedWords.length === 0) {
                answerArea.innerHTML = '<span class="text-gray-500">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–∞ –Ω–∏–∂–µ...</span>';
            } else {
                answerArea.innerHTML = selectedWords.map((word, index) => `
                    <div class="word-tile selected arabic-text text-xl" onclick="removeWord(${index})">
                        ${word}
                    </div>
                `).join('');
            }
            
            document.getElementById('check-btn').disabled = selectedWords.length === 0;
        }

        function removeWord(index) {
            const word = selectedWords[index];
            selectedWords.splice(index, 1);
            
            const wordIndex = availableWords.indexOf(word);
            const wordTile = document.querySelector(`[data-index="${wordIndex}"]`);
            if (wordTile) {
                wordTile.classList.remove('disabled');
            }
            
            updateAnswerArea();
        }

        function clearPracticeAnswer() {
            selectedWords = [];
            
            document.querySelectorAll('.word-tile.disabled').forEach(tile => {
                tile.classList.remove('disabled');
            });
            
            updateAnswerArea();
        }

        function checkPracticeAnswer() {
            const sentence = practiceSentences[currentPracticeSentence];
            const isCorrect = JSON.stringify(selectedWords) === JSON.stringify(sentence.correctOrder);
            
            const answerArea = document.getElementById('answer-area');
            
            if (isCorrect) {
                practiceCorrectAnswers++;
                answerArea.classList.add('correct');
                showToast('–ü—Ä–∞–≤–∏–ª—å–Ω–æ! üéâ');
            } else {
                answerArea.classList.add('incorrect');
                showToast('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!', 'error');
            }
            
            setTimeout(() => {
                currentPracticeSentence++;
                renderPracticeTask();
            }, 1500);
        }

        function showPracticeResults() {
            const container = document.getElementById('practice-task');
            container.innerHTML = `
                <div class="text-center">
                    <div class="text-6xl mb-4">üéâ</div>
                    <h2 class="text-2xl font-bold text-white neon-text mb-4">–ü—Ä–∞–∫—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h2>
                    <div class="text-green-300 mb-6">
                        <p>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: <span class="font-semibold text-white">${practiceCorrectAnswers}</span> –∏–∑ <span class="font-semibold text-white">7</span></p>
                    </div>
                    <div class="bg-gray-800 border border-cyan-400 rounded-lg p-4 mb-6">
                        <h3 class="font-semibold text-cyan-300 mb-2">–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!</h3>
                        <div class="text-sm text-gray-300">
                            –í—ã –ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞–ª–∏ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –Ω–∞ –∞—Ä–∞–±—Å–∫–æ–º
                        </div>
                    </div>
                    <div class="flex gap-3 justify-center">
                        <button class="glow-button px-8 py-3 rounded-lg font-semibold transition-all" onclick="showPractice()">
                            –ü–æ–≤—Ç–æ—Ä–∏—Ç—å
                        </button>
                        <button class="bg-gray-700 hover:bg-gray-600 text-white px-8 py-3 rounded-lg transition-colors" onclick="showHome()">
                            –ù–∞ –≥–ª–∞–≤–Ω—É—é
                        </button>
                    </div>
                </div>
            `;
        }

        // Start lesson
        function startLesson(lessonId) {
            const lessonWords = vocabularyData[lessonId];
            
            currentLesson = {
                id: lessonId,
                type: 'lesson',
                title: `–£—Ä–æ–∫ ${lessonId}`,
                description: `${lessonWords.length} –Ω–æ–≤—ã—Ö —Å–ª–æ–≤`,
                newWords: lessonWords,
                tasks: generateLessonTasks(lessonId, lessonWords)
            };
            
            currentTaskIndex = 0;
            correctAnswers = 0;
            userAnswers = [];
            incorrectTasks = [];
            isReviewMode = false;
            
            document.getElementById('lesson-selection').classList.add('hidden');
            document.getElementById('lesson-screen').classList.remove('hidden');
            
            document.getElementById('lesson-title-header').textContent = currentLesson.title;
            
            renderCurrentTask();
        }

        // Generate lesson tasks
        function generateLessonTasks(lessonId, newWords) {
            const tasks = [];
            
            // Word introduction tasks
            newWords.forEach((word, index) => {
                tasks.push({
                    id: tasks.length + 1,
                    type: "word_introduction",
                    question: "–ù–æ–≤–æ–µ —Å–ª–æ–≤–æ:",
                    word: word,
                    explanation: "–ó–∞–ø–æ–º–Ω–∏—Ç–µ —ç—Ç–æ —Å–ª–æ–≤–æ"
                });
            });
            
            // Translation tasks
            newWords.forEach((word, index) => {
                const otherWords = newWords.filter(w => w.arabic !== word.arabic).slice(0, 3);
                const allOptions = [word, ...otherWords];
                const shuffledOptions = [...allOptions].sort(() => Math.random() - 0.5);
                const correctIndex = shuffledOptions.findIndex(w => w.arabic === word.arabic);
                
                tasks.push({
                    id: tasks.length + 1,
                    type: "translation",
                    question: "–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ:",
                    arabic: word.arabic,
                    options: shuffledOptions.map(w => w.translation),
                    correct: correctIndex,
                    explanation: `${word.arabic} - ${word.translation}`
                });
            });
            
            return tasks;
        }

        // Render current task
        function renderCurrentTask() {
            const task = currentLesson.tasks[currentTaskIndex];
            const container = document.getElementById('task-container');
            
            container.innerHTML = '';
            container.className = 'task-card bg-white rounded-xl shadow-lg p-8 fade-in';
            
            if (task.type === 'word_introduction') {
                renderWordIntroduction(task, container);
            } else if (task.type === 'translation') {
                renderTranslationTask(task, container);
            }
        }

        function renderWordIntroduction(task, container) {
            container.innerHTML = `
                <div class="text-center">
                    <div class="mb-4">
                        <span class="text-sm text-green-300">${currentLesson.title}</span>
                        <div class="text-xs text-gray-400">${currentTaskIndex + 1} / ${currentLesson.tasks.length}</div>
                    </div>
                    <h2 class="text-2xl font-semibold text-white mb-6">–ù–æ–≤–æ–µ —Å–ª–æ–≤–æ:</h2>
                    
                    <div class="bg-gradient-to-r from-gray-800 to-gray-700 border border-green-400 rounded-xl p-6 mb-6 max-w-md mx-auto">
                        <div class="arabic-text text-4xl text-white mb-3">${task.word.arabic}</div>
                        <div class="text-3xl text-green-300 mb-2">${task.word.translation}</div>
                        <div class="text-lg text-gray-400">${getTypeTranslation(task.word.type)}</div>
                        <div class="text-sm text-cyan-300 mt-2">–ö–æ—Ä–µ–Ω—å: ${task.word.root}</div>
                    </div>
                    
                    <button class="glow-button px-8 py-3 rounded-lg font-semibold transition-all text-lg" onclick="continueToNext()">
                        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
                    </button>
                </div>
            `;
        }

        function renderTranslationTask(task, container) {
            container.innerHTML = `
                <div class="text-center">
                    <div class="mb-4">
                        <span class="text-lg text-green-300">${currentLesson.title}</span>
                        <div class="text-sm text-gray-400">${currentTaskIndex + 1} / ${currentLesson.tasks.length}</div>
                    </div>
                    <h2 class="text-2xl font-semibold text-white mb-6">${task.question}</h2>
                    <div class="arabic-text bg-gradient-to-r from-gray-800 to-gray-700 border border-green-400 rounded-lg p-6 mb-8 text-center text-white text-3xl">
                        ${task.arabic}
                    </div>
                    <div class="grid grid-cols-1 gap-4">
                        ${task.options.map((option, index) => `
                            <button class="option-button rounded-lg p-4 text-left transition-all text-lg" 
                                    onclick="selectAnswer(${index})">
                                ${option}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function getTypeTranslation(type) {
            const translations = {
                'noun': '–°—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ',
                'verb': '–ì–ª–∞–≥–æ–ª',
                'adjective': '–ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ',
                'preposition': '–ü—Ä–µ–¥–ª–æ–≥',
                'pronoun': '–ú–µ—Å—Ç–æ–∏–º–µ–Ω–∏–µ',
                'particle': '–ß–∞—Å—Ç–∏—Ü–∞',
                'interrogative': '–í–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ'
            };
            return translations[type] || type;
        }

        // Answer handling
        function selectAnswer(answerIndex) {
            currentAnswer = answerIndex;
            const task = currentLesson.tasks[currentTaskIndex];
            
            const buttons = document.querySelectorAll('.option-button');
            buttons.forEach((btn, index) => {
                btn.classList.remove('correct-answer', 'incorrect-answer');
                if (index === answerIndex) {
                    if (index === task.correct) {
                        btn.classList.add('correct-answer');
                    } else {
                        btn.classList.add('incorrect-answer');
                    }
                }
                if (index === task.correct && index !== answerIndex) {
                    btn.classList.add('correct-answer');
                }
                btn.disabled = true;
            });

            storeAnswer(task, answerIndex);
            
            setTimeout(() => {
                continueToNext();
            }, 500);
        }

        function storeAnswer(task, answer) {
            const isCorrect = answer === task.correct;
            
            if (isCorrect) {
                correctAnswers++;
            } else {
                if (!incorrectTasks.some(t => t.id === task.id)) {
                    incorrectTasks.push({...task});
                }
            }
            
            userAnswers.push({
                taskId: task.id,
                userAnswer: answer,
                correctAnswer: task.correct,
                isCorrect: isCorrect
            });
        }

        function continueToNext() {
            currentTaskIndex++;
            
            if (currentTaskIndex >= currentLesson.tasks.length) {
                if (incorrectTasks.length > 0 && !isReviewMode) {
                    startReviewMode();
                } else {
                    completeLesson();
                }
            } else {
                renderCurrentTask();
            }
        }

        function startReviewMode() {
            isReviewMode = true;
            currentLesson.tasks = [...incorrectTasks];
            incorrectTasks = [];
            currentTaskIndex = 0;
            
            showToast('–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã');
            
            renderCurrentTask();
        }

        function completeLesson() {
            const passed = true;
            userProgress.completedLessons.add(currentLesson.id);
            
            if (!learnedWordsPerLesson.has(currentLesson.id)) {
                learnedWordsPerLesson.set(currentLesson.id, new Set());
            }
            currentLesson.newWords.forEach(word => {
                learnedWordsPerLesson.get(currentLesson.id).add(word.arabic);
            });
            
            saveProgress();
            showResults(passed);
        }

        function showResults(passed) {
            document.getElementById('task-container').classList.add('hidden');
            document.getElementById('results-container').classList.remove('hidden');
            
            const resultsTitle = document.getElementById('results-title');
            resultsTitle.textContent = '–£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à—ë–Ω!';
            resultsTitle.className = 'text-2xl font-bold text-green-400 neon-text mb-4';
            
            document.getElementById('correct-answers').textContent = correctAnswers;
            document.getElementById('total-tasks').textContent = currentLesson.tasks.length;
            
            updateOverallProgress();
            updateHomeProgress();
            updateLessonCards();
        }

        // Dictionary functions
        function showDictionary() {
            document.getElementById('home-screen').classList.add('hidden');
            document.getElementById('lesson-selection').classList.add('hidden');
            document.getElementById('dictionary-screen').classList.remove('hidden');
            
            generateDictionary();
        }

        function generateDictionary() {
            const learnedWords = [];
            
            userProgress.completedLessons.forEach(lessonId => {
                const lessonWords = vocabularyData[lessonId];
                if (lessonWords) {
                    learnedWords.push(...lessonWords.map(word => ({...word, lessonId})));
                }
            });
            
            document.getElementById('dict-word-count').textContent = learnedWords.length;
            renderDictionary(learnedWords);
            setupDictionaryFilters(learnedWords);
        }

        function renderDictionary(words) {
            const container = document.getElementById('dictionary-content');
            
            if (words.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="text-6xl mb-4">üìö</div>
                        <h3 class="text-xl text-white mb-2">–°–ª–æ–≤–∞—Ä—å –ø—É—Å—Ç</h3>
                        <p class="text-gray-400 mb-6">–ü—Ä–æ–π–¥–∏—Ç–µ —É—Ä–æ–∫, —á—Ç–æ–±—ã –ø–æ–ø–æ–ª–Ω–∏—Ç—å —Å–ª–æ–≤–∞—Ä—å</p>
                        <button class="glow-button px-6 py-3 rounded-lg font-semibold" onclick="showLessons()">
                            –ù–∞—á–∞—Ç—å –∏–∑—É—á–µ–Ω–∏–µ
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = words.map((word, index) => `
                <div class="dictionary-card" onclick="flipCard(${index})">
                    <div class="card-inner" id="card-${index}">
                        <div class="card-front">
                            <div class="arabic-text text-2xl text-white mb-2">${word.arabic}</div>
                            <div class="text-xs text-gray-400">${getTypeTranslation(word.type)}</div>
                        </div>
                        <div class="card-back">
                            <div class="text-lg text-white mb-2">${word.translation}</div>
                            <div class="text-xs text-cyan-400">–ö–æ—Ä–µ–Ω—å: ${word.root}</div>
                            <div class="text-xs text-gray-400 mt-1">–£—Ä–æ–∫ ${word.lessonId}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function flipCard(index) {
            const card = document.getElementById(`card-${index}`).parentElement;
            card.classList.toggle('flipped');
        }

        function setupDictionaryFilters(allWords) {
            const searchInput = document.getElementById('search-input');
            const typeFilter = document.getElementById('type-filter');
            
            function filterWords() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedType = typeFilter.value;
                
                let filteredWords = allWords;
                
                if (searchTerm) {
                    filteredWords = filteredWords.filter(word => 
                        word.arabic.includes(searchTerm) || 
                        word.translation.toLowerCase().includes(searchTerm)
                    );
                }
                
                if (selectedType) {
                    filteredWords = filteredWords.filter(word => word.type === selectedType);
                }
                
                renderDictionary(filteredWords);
            }
            
            searchInput.addEventListener('input', filterWords);
            typeFilter.addEventListener('change', filterWords);
        }

        // Update lesson cards to show completion status
        function updateLessonCards() {
            for (let i = 1; i <= 5; i++) {
                const card = document.getElementById(`lesson-${i}`);
                if (card) {
                    if (userProgress.completedLessons.has(i)) {
                        card.classList.add('completed');
                    } else {
                        card.classList.remove('completed');
                    }
                }
            }
        }

        // Navigation functions
        function showHome() {
            document.getElementById('home-screen').classList.remove('hidden');
            document.getElementById('lesson-selection').classList.add('hidden');
            document.getElementById('practice-screen').classList.add('hidden');
            document.getElementById('dictionary-screen').classList.add('hidden');
            document.getElementById('lesson-screen').classList.add('hidden');
            document.getElementById('results-container').classList.add('hidden');
            
            updateHomeProgress();
        }

        function showLessons() {
            document.getElementById('home-screen').classList.add('hidden');
            document.getElementById('lesson-selection').classList.remove('hidden');
            document.getElementById('dictionary-screen').classList.add('hidden');
            document.getElementById('practice-screen').classList.add('hidden');
            
            updateLessonCards();
        }

        function backToLessons() {
            document.getElementById('lesson-screen').classList.add('hidden');
            document.getElementById('lesson-selection').classList.remove('hidden');
            document.getElementById('results-container').classList.add('hidden');
            document.getElementById('task-container').classList.remove('hidden');
            
            updateLessonCards();
        }

        function updateOverallProgress() {
            const completed = userProgress.completedLessons.size;
            const total = 5;
            const percentage = (completed / total) * 100;
            
            document.getElementById('overall-progress').textContent = `${completed}/${total}`;
            document.getElementById('overall-progress-bar').style.width = `${percentage}%`;
        }

        function updateHomeProgress() {
            const completed = userProgress.completedLessons.size;
            document.getElementById('home-progress').textContent = `${completed}/5`;
            
            const learnedWords = getLearnedWordsCount();
            document.getElementById('words-learned').textContent = learnedWords;
        }

        function getLearnedWordsCount() {
            let count = 0;
            userProgress.completedLessons.forEach(lessonId => {
                const lessonWords = vocabularyData[lessonId];
                if (lessonWords) {
                    count += lessonWords.length;
                }
            });
            return count;
        }

        // Initialize app
        function initializeApp() {
            loadProgress();
            updateOverallProgress();
            updateHomeProgress();
            updateLessonCards();
        }

        initializeApp();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a9b5ab19345dcc9',t:'MTc2NTAxOTYxMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>